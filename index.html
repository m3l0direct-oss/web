<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>UniPilot â€” Student OS</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bgA:#070b14; --bgB:#0a1324;
      --surface: rgba(255,255,255,.045);
      --stroke: rgba(255,255,255,.09);
      --stroke2: rgba(255,255,255,.14);
      --txt:#eaf1ff; --mut:#a8b6cf;
      --accent:#67e8f9; --accent2:#a7f3d0;
      --warn:#fbbf24; --danger:#fb7185; --ok:#34d399;
      --r1: 14px; --r2: 18px; --r3: 22px;
      --shadow1: 0 16px 38px rgba(0,0,0,.35);
      --shadow2: 0 10px 22px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      font-family:"Tajawal",system-ui,-apple-system,Segoe UI,Arial;
      color: var(--txt);
      padding:22px 14px 60px;
      display:flex; justify-content:center; align-items:flex-start;
      background:
        radial-gradient(1200px 650px at 80% -10%, rgba(103,232,249,.14), transparent 58%),
        radial-gradient(900px 520px at 10% 10%, rgba(167,243,208,.10), transparent 55%),
        linear-gradient(180deg, var(--bgB), var(--bgA));
    }
    .wrap{width:min(1180px,100%)}

    header{
      position: sticky; top: 10px; z-index: 20;
      padding: 12px; border-radius: var(--r3);
      border: 1px solid var(--stroke);
      background: rgba(10,18,32,.62);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow2);
      display:flex; justify-content:space-between; align-items:center;
      gap:12px; flex-wrap:wrap; margin-bottom: 14px;
    }
    .brand{display:flex; gap:10px; align-items:center;}
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: linear-gradient(135deg, rgba(103,232,249,.95), rgba(167,243,208,.9));
      position:relative;
      box-shadow:0 10px 28px rgba(103,232,249,.12);
      overflow:hidden;
    }
    .logo:before{
      content:"";
      position:absolute; inset:-30%;
      background:
        radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), transparent 45%),
        radial-gradient(circle at 70% 80%, rgba(0,0,0,.25), transparent 55%);
      transform: rotate(18deg);
    }
    .brand h1{margin:0; font-size:18px; font-weight:950; letter-spacing:.2px}
    .brand .sub{margin-top:3px; color:var(--mut); font-size:12.8px}

    .top{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end;}
    .pill{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      padding:10px 12px;
      border-radius:999px;
      font-size:13px;
      color:var(--mut);
      display:flex; gap:8px; align-items:center;
      white-space:nowrap;
    }

    .btn{
      cursor:pointer; user-select:none;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.035);
      color: var(--txt);
      padding:10px 13px;
      border-radius: 14px;
      font-weight:900;
      transition: transform .08s ease, background .12s ease, border-color .12s ease;
      white-space:nowrap;
    }
    .btn:hover{background: rgba(255,255,255,.06); border-color: var(--stroke2);}
    .btn:active{transform: translateY(1px);}
    .btn.primary{
      border:none; color:#06202a;
      background: linear-gradient(135deg, rgba(103,232,249,.95), rgba(167,243,208,.9));
      box-shadow: 0 16px 32px rgba(103,232,249,.10);
    }
    .btn.danger{
      background: rgba(251,113,133,.07);
      border-color: rgba(251,113,133,.25);
      color: #ffd2da;
    }
    .btn.ok{
      background: rgba(52,211,153,.08);
      border-color: rgba(52,211,153,.22);
      color: rgba(220,255,242,.95);
    }
    .smallBtn{ padding: 8px 10px; border-radius: 12px; font-weight: 950; }
    .ghostBtn{ background:transparent; border:none; color: var(--accent); font-weight:950; cursor:pointer; padding:0; }

    .tabs{
      margin: 14px 0 18px;
      padding: 10px;
      border-radius: var(--r3);
      border: 1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow2);
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .tab{
      border-radius: 14px;
      padding: 10px 12px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--mut);
      cursor:pointer;
      font-weight:950;
      user-select:none;
      transition:.12s ease;
    }
    .tab:hover{ background: rgba(255,255,255,.04); color: var(--txt);}
    .tab.active{
      background: linear-gradient(135deg, rgba(103,232,249,.16), rgba(167,243,208,.10));
      border-color: rgba(103,232,249,.32);
      color: var(--txt);
    }

    .grid{display:grid; grid-template-columns:1.2fr .8fr; gap:16px;}
    @media(max-width: 980px){ .grid{grid-template-columns:1fr; gap:14px;} header{top:10px;} }

    .card{
      border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.055), rgba(255,255,255,.02));
      border-radius: var(--r3);
      box-shadow: var(--shadow1);
      overflow:hidden;
    }
    .hd{padding: 18px 18px 0;}
    .body{padding: 18px;}
    .title{margin:0 0 6px; font-size: 17px; font-weight: 950;}
    .hint{margin:0 0 12px; color: var(--mut); font-size: 13.2px; line-height:1.8;}

    .sep{height:1px; background: var(--stroke); margin:16px 0; opacity:.9;}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .two{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    @media(max-width: 700px){ .two{grid-template-columns:1fr;} }

    label{display:block; font-size: 12.5px; color: var(--mut); margin-bottom:6px;}
    input, select, textarea{
      width:100%;
      border:1px solid var(--stroke);
      background: rgba(0,0,0,.16);
      color: var(--txt);
      border-radius: 16px;
      padding: 11px 12px;
      outline:none;
      font-family:inherit;
      font-size:14px;
    }
    input:focus, select:focus, textarea:focus{border-color: rgba(103,232,249,.55);}
    textarea{min-height:92px; resize:vertical; line-height:1.7;}

    .kpi{display:grid; grid-template-columns: repeat(3, 1fr); gap:10px;}
    @media(max-width: 520px){ .kpi{grid-template-columns:1fr;} }
    .box{
      border: 1px solid var(--stroke);
      border-radius: var(--r2);
      background: rgba(255,255,255,.03);
      padding:12px;
    }
    .box .k{font-size:12px; color: var(--mut);}
    .box .v{font-size:20px; font-weight:950; margin-top:6px; letter-spacing:.2px}

    .list{
      display:flex; flex-direction:column; gap:12px;
      max-height: 560px;
      overflow:auto;
      padding-left:2px;
    }
    .item{
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      border-radius: var(--r2);
      padding:14px;
    }
    .item .topRow{display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:flex-start;}
    .meta{font-size:12px; color: var(--mut); line-height:1.7;}

    .badge{
      font-size:12px; font-weight:950;
      padding: 6px 10px;
      border-radius: 999px;
      color:#06202a;
      background: linear-gradient(135deg, rgba(103,232,249,.9), rgba(167,243,208,.85));
    }
    .badge.warn{ background: linear-gradient(135deg, rgba(251,191,36,.92), rgba(167,243,208,.55)); }
    .badge.danger{ background: linear-gradient(135deg, rgba(251,113,133,.92), rgba(251,191,36,.6)); }
    .badge.ok{ background: linear-gradient(135deg, rgba(52,211,153,.92), rgba(103,232,249,.55)); }

    .quote{
      border-right: 3px solid rgba(103,232,249,.55);
      background: rgba(103,232,249,.05);
      border-radius: var(--r2);
      padding:10px 12px;
      line-height:1.85;
      font-size:13.4px;
      color: rgba(234,241,255,.92);
    }
    .hr{height:1px; background: var(--stroke); margin:10px 0;}

    .actions{
      display:flex; gap:10px; flex-wrap:wrap;
      width:100%; justify-content:flex-end;
    }
    .actions .btn{ padding: 8px 10px; border-radius: 12px; background: rgba(255,255,255,.03);}
    .actions .btn.primary{ background: linear-gradient(135deg, rgba(103,232,249,.85), rgba(167,243,208,.80)); color:#06202a; }

    .seg{
      display:flex; gap:8px; flex-wrap:wrap;
      padding:8px;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.03);
      border-radius: 16px;
    }
    .segBtn{
      cursor:pointer;
      border:1px solid transparent;
      background: transparent;
      color: var(--mut);
      padding: 9px 12px;
      border-radius: 14px;
      font-weight: 950;
      user-select:none;
    }
    .segBtn:hover{ background: rgba(255,255,255,.04); color: var(--txt); }
    .segBtn.active{
      background: linear-gradient(135deg, rgba(103,232,249,.16), rgba(167,243,208,.10));
      border-color: rgba(103,232,249,.30);
      color: var(--txt);
    }

    .hidden{display:none !important;}

    .toast{
      position:fixed;
      left:14px; bottom:14px;
      background: rgba(10,18,32,.82);
      border:1px solid var(--stroke);
      border-radius:14px;
      padding:10px 12px;
      color: var(--txt);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow1);
      display:none;
      max-width: min(560px, calc(100% - 28px));
      z-index: 9999;
      font-size:14px;
      line-height:1.6;
    }
    .toast.show{display:block;}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;}

    .modalBack{
      position:fixed; inset:0;
      background: rgba(0,0,0,.55);
      backdrop-filter: blur(6px);
      display:flex; align-items:center; justify-content:center;
      z-index:9998;
      padding: 18px;
    }
    .modal{
      width:min(560px, 100%);
      border:1px solid var(--stroke);
      background: rgba(10,18,32,.88);
      border-radius: var(--r3);
      box-shadow: var(--shadow1);
      overflow:hidden;
    }
    .modalHd{padding:16px 16px 0;}
    .modalBody{padding:16px;}
    .modalFooter{padding:0 16px 16px; display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;}
    .mini{font-size:12.8px; color:var(--mut); line-height:1.75;}

    table{
      width:100%;
      border-collapse: collapse;
      border:1px solid var(--stroke);
      border-radius: 16px;
      overflow:hidden;
      background: rgba(255,255,255,.02);
    }
    th, td{
      padding: 10px 10px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      text-align:right;
      font-size: 13px;
      vertical-align: top;
    }
    th{color: rgba(234,241,255,.90); font-weight:950; background: rgba(255,255,255,.03);}
    td{color: rgba(234,241,255,.92);}
    tr:hover td{background: rgba(103,232,249,.04);}
    .clickRow{cursor:pointer}
  </style>
</head>

<body>
<div class="wrap">

  <header>
    <div class="brand">
      <div class="logo" aria-label="UniPilot logo"></div>
      <div>
        <h1>UniPilot</h1>
        <div class="sub">Student OS Â· GPA Â· Tasks Â· Planner Â· Coach Â· Admin</div>
      </div>
    </div>

    <div class="top">
      <div class="pill"><span>Ø§Ù„Ø­Ø³Ø§Ø¨:</span> <span id="userLabel">ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„</span></div>
      <div class="pill"><span>Ø§Ù„Ø¯ÙˆØ±:</span> <span id="roleLabel">â€”</span></div>

      <button class="btn" id="btnBackup" disabled>ØªØµØ¯ÙŠØ±</button>
      <button class="btn" id="btnRestore" disabled>Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
      <button class="btn" id="btnOpenSettings" disabled>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
      <button class="btn danger" id="btnLogout" disabled>ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
    </div>
  </header>

  <!-- STUDENT TABS -->
  <div id="studentTabs" class="tabs hidden">
    <div class="tab active" data-view="tasks">Ø§Ù„Ù…Ù‡Ø§Ù…</div>
    <div class="tab" data-view="gpa">GPA</div>
    <div class="tab" data-view="planner">Ø®Ø·Ø© Ø§Ù„Ù…ÙˆØ§Ø¯</div>
   

    <div class="tab" data-view="coach">Coach</div>
    <div class="tab" data-view="settings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
  </div>

  <!-- ADMIN TABS -->
  <div id="adminTabs" class="tabs hidden">
    <div class="tab active" data-adminview="admin_home">Admin Dashboard</div>
    <div class="tab" data-adminview="admin_users">Ø§Ù„Ø·Ù„Ø§Ø¨</div>
    <div class="tab" data-adminview="admin_settings">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</div>
  </div>

  <!-- ================= STUDENT APP ================= -->
  <div id="studentApp" class="hidden">

    <!-- TASKS -->
    <div id="view_tasks">
      <div class="grid">
        <section class="card">
          <div class="hd">
            <h2 class="title">Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù…Ø©</h2>
            <p class="hint">Ø§ÙƒØªØ¨ â€œØ£ÙˆÙ„ Ø®Ø·ÙˆØ©â€ ÙˆØ¨Ø³ â€” Ù‡ÙŠÙƒ Ø¨ØªÙ‚Ù„Ù„ Ø§Ù„ØªÙˆØªØ± ÙˆØªØ²ÙŠØ¯ Ø§Ù„Ø¥Ù†Ø¬Ø§Ø².</p>
          </div>
          <div class="body">
            <div class="two">
              <div>
                <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                <input id="taskTitle" placeholder="Ù…Ø«Ø§Ù„: ØªÙ„Ø®ÙŠØµ Ù…Ø­Ø§Ø¶Ø±Ø© 5 / Ø­Ù„ ÙˆØ§Ø¬Ø¨ 3" />
              </div>
              <div>
                <label>Ø§Ù„Ù…Ø§Ø¯Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input id="taskCourse" placeholder="Ù…Ø«Ø§Ù„: CS201 / CALC2" />
              </div>
            </div>

            <div class="two" style="margin-top:12px;">
              <div>
                <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ù„ÙŠÙ…</label>
                <input id="taskDue" type="date"/>
              </div>
              <div>
                <label>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹ (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                <input id="taskMin" type="number" min="5" step="5" value="60"/>
              </div>
            </div>

            <div class="two" style="margin-top:12px;">
              <div>
                <label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©</label>
                <select id="taskPrio">
                  <option value="high">Ø¹Ø§Ù„ÙŠØ©</option>
                  <option value="med" selected>Ù…ØªÙˆØ³Ø·Ø©</option>
                  <option value="low">Ù…Ù†Ø®ÙØ¶Ø©</option>
                </select>
              </div>
              <div>
                <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù‡Ù…Ø©</label>
                <select id="taskType">
                  <option value="assignment" selected>ÙˆØ§Ø¬Ø¨</option>
                  <option value="quiz">ÙƒÙˆÙŠØ²</option>
                  <option value="exam">Ø§Ù…ØªØ­Ø§Ù†</option>
                  <option value="project">Ù…Ø´Ø±ÙˆØ¹</option>
                  <option value="study">Ø¯Ø±Ø§Ø³Ø©</option>
                  <option value="admin">Ø£Ù…ÙˆØ± Ø¬Ø§Ù…Ø¹Ø©</option>
                </select>
              </div>
            </div>

            <div style="margin-top:12px;">
              <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
              <textarea id="taskNotes" placeholder="Ù…Ø«Ø§Ù„: Ø§ÙØªØ­ Ø§Ù„Ù…Ù„Ù + Ø§ÙƒØªØ¨ Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†."></textarea>
            </div>

            <div class="row" style="margin-top:12px;">
              <button class="btn primary" id="btnAddTask" disabled>Ø¥Ø¶Ø§ÙØ©</button>
              <button class="btn" id="btnPlanToday" disabled>Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ…</button>
            </div>

            <div class="sep"></div>

            <div class="kpi">
              <div class="box"><div class="k">Ù…Ù‡Ù…Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div><div class="v" id="kToday">â€”</div></div>
              <div class="box"><div class="k">Ø®Ù„Ø§Ù„ 7 Ø£ÙŠØ§Ù…</div><div class="v" id="kWeek">â€”</div></div>
              <div class="box"><div class="k">Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div><div class="v" id="kDonePct">â€”</div></div>
            </div>

            <div class="sep"></div>
            <div class="quote" id="todayPlanMsg">Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ø§Ù‹ âœ…</div>
          </div>
        </section>

        <aside class="card">
          <div class="hd">
            <h2 class="title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
            <p class="hint">ÙÙ„ØªØ±Ø© Ø¨Ø³ÙŠØ·Ø©: Ø§Ù„ÙŠÙˆÙ… / Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ / Ø§Ù„ÙƒÙ„ / Ù…ØªØ£Ø®Ø±Ø©</p>
          </div>
          <div class="body">
            <div class="seg" id="taskSeg">
              <button class="segBtn" id="fToday" data-f="today" disabled>Ø§Ù„ÙŠÙˆÙ…</button>
              <button class="segBtn" id="fWeek" data-f="week" disabled>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
              <button class="segBtn active" id="fAll" data-f="all" disabled>Ø§Ù„ÙƒÙ„</button>
              <button class="segBtn" id="fOver" data-f="over" disabled>Ù…ØªØ£Ø®Ø±Ø©</button>
            </div>

            <div class="sep"></div>
            <div class="list" id="taskList">
            </div>
          </div>
        </aside>
      </div>
    </div>

    <!-- GPA -->
    <div id="view_gpa" class="hidden">
      <div class="grid">
        <section class="card">
          <div class="hd">
            <h2 class="title">GPA â€” Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…ÙˆØ² + Ø£Ù‚Ù„/Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø¯Ù„</h2>
            <p class="hint">Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ù…Ø² (Ù…Ø«Ù„Ø§Ù‹: Ø£+ / A+). Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ­Ø³Ø¨ Ø£Ù‚Ù„/Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø¯Ù„ Ø­Ø³Ø¨ Ø±ÙŠÙ†Ø¬ Ø§Ù„Ø±Ù…Ø².</p>
          </div>

          <div class="body">

            <div class="item">
              <div class="topRow">
                <div style="font-weight:950">Ø¥Ø¶Ø§ÙØ© Ù…Ø§Ø¯Ø© Ù…Ø£Ø®ÙˆØ°Ø©</div>
                <div class="meta">Ø§Ù„Ø±Ù…Ø² Ø¹Ø±Ø¨ÙŠ/Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ âœ…</div>
              </div>
              <div class="hr"></div>

              <div class="two">
                <div>
                  <label>Ø§Ø³Ù…/ÙƒÙˆØ¯ Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                  <input id="takenName" placeholder="Ù…Ø«Ø§Ù„: CS201 / Calculus II" />
                </div>
                <div>
                  <label>Ø§Ù„Ø³Ø§Ø¹Ø§Øª</label>
                  <input id="takenCredits" type="number" min="1" step="1" value="3"/>
                </div>
              </div>

              <div class="two" style="margin-top:12px;">
                <div>
                  <label>Ø§Ù„Ø±Ù…Ø² (Ù…Ø«Ø§Ù„: Ø£+ Ø£Ùˆ A+)</label>
                  <input id="takenGrade" list="gradeSymbols" placeholder="Ø£+ / Ø£ / Ø£- / Ø¨+ ..." />
                  <datalist id="gradeSymbols"></datalist>
                </div>
                <div>
                  <label>ØªØµÙ†ÙŠÙ (Ù„Ù„ØªØ­Ù„ÙŠÙ„)</label>
                  <select id="takenCat">
                    <option value="major" selected>ØªØ®ØµØµ</option>
                    <option value="math">Ø±ÙŠØ§Ø¶ÙŠØ§Øª</option>
                    <option value="programming">Ø¨Ø±Ù…Ø¬Ø©</option>
                    <option value="lab">Ù…Ø®ØªØ¨Ø±</option>
                    <option value="general">Ø¬Ø§Ù…Ø¹Ø©</option>
                    <option value="elective">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</option>
                  </select>
                </div>
              </div>

              <div class="row" style="margin-top:12px;">
                <button class="btn primary" id="btnAddTaken" disabled>Ø¥Ø¶Ø§ÙØ©</button>
              </div>
            </div>

            <div class="sep"></div>

            <div class="kpi">
              <div class="box"><div class="k">GPA (ØªÙ‚Ø±ÙŠØ¨ÙŠ)</div><div class="v" id="gpaC">â€”</div></div>
              <div class="box"><div class="k">Ø³Ø§Ø¹Ø§Øª Ù…Ù†Ø¬Ø²Ø©</div><div class="v" id="crDone">â€”</div></div>
              <div class="box"><div class="k">Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ§Ø¯</div><div class="v" id="coursesCount">â€”</div></div>
            </div>

            <div class="sep"></div>

            <div class="kpi">
              <div class="box"><div class="k">Ø£Ù‚Ù„ Ù…Ø¹Ø¯Ù„ Ù…Ù…ÙƒÙ†</div><div class="v" id="minGpaPossible">â€”</div></div>
              <div class="box"><div class="k">Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø¯Ù„ Ù…Ù…ÙƒÙ†</div><div class="v" id="maxGpaPossible">â€”</div></div>
              <div class="box"><div class="k">Points/Ø³Ø§Ø¹Ø©</div><div class="v" id="ppc">â€”</div></div>
            </div>

            <div class="sep"></div>
            <div class="quote" id="gpaMsg">Ø£Ø¶Ù Ù…ÙˆØ§Ø¯Ùƒ Ø¹Ø´Ø§Ù† ÙŠØ·Ù„Ø¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„.</div>

          </div>
        </section>

        <aside class="card">
          <div class="hd">
            <h2 class="title">Ù…ÙˆØ§Ø¯ Ø£Ø®Ø°ØªÙ‡Ø§</h2>
            <p class="hint">Ø­Ø°Ù Ø³Ø±ÙŠØ¹ Ù„Ø£ÙŠ Ù…Ø§Ø¯Ø©.</p>
          </div>
          <div class="body">
            <div class="list" id="takenList">
             </div>
            </div>
          </div>
        </aside>

      </div>
    </div>

    <!-- PLANNER -->
    <div id="view_planner" class="hidden">
      <div class="grid">
        <section class="card">
          <div class="hd">
            <h2 class="title">Ø®Ø·Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ + Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª</h2>
            <p class="hint">Ø£Ø¶Ù Ù…ÙˆØ§Ø¯ Ø®Ø·ØªÙƒ. Ø¨Ø¹Ø¯Ù‡Ø§ Ø¨Ù†Ø·Ù„Ø¹ Ù„Ùƒ â€œØ´Ùˆ Ù…ØªØ§Ø­ ØªÙ†Ø²Ù„â€.</p>
          </div>
          <div class="body">
            <div class="two">
              <div>
                <label>ÙƒÙˆØ¯ Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                <input id="planCode" placeholder="Ù…Ø«Ø§Ù„: CS220"/>
              </div>
              <div>
                <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</label>
                <input id="planName" placeholder="Ù…Ø«Ø§Ù„: Data Structures"/>
              </div>
            </div>

            <div class="two" style="margin-top:12px;">
              <div>
                <label>Ø§Ù„Ø³Ø§Ø¹Ø§Øª</label>
                <input id="planCredits" type="number" min="1" step="1" value="3"/>
              </div>
              <div>
                <label>ØªØµÙ†ÙŠÙ</label>
                <select id="planCat">
                  <option value="major" selected>ØªØ®ØµØµ</option>
                  <option value="general">Ø¬Ø§Ù…Ø¹Ø©</option>
                  <option value="elective">Ø§Ø®ØªÙŠØ§Ø±ÙŠ</option>
                  <option value="support">Ù…Ø³Ø§Ù†Ø¯Ø©</option>
                </select>
              </div>
            </div>

            <div style="margin-top:12px;">
              <label>Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© â€” Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©</label>
              <input id="planPrereq" placeholder="Ù…Ø«Ø§Ù„: CS101, MATH101"/>
            </div>
         <div class="hr"></div>
  <div class="row" style="margin-top:12px;">
              <button class="btn primary" id="btnAddPlan" disabled>Ø¥Ø¶Ø§ÙØ©</button>
              <button class="btn" id="btnSuggestCourses" disabled>Ù…ÙˆØ§Ø¯ Ù…ØªØ§Ø­Ø©</button>
            </div>
<div class="item" style="background: linear-gradient(135deg, rgba(103,232,249,.08), rgba(167,243,208,.05)); border-color:var(--accent);">
  <div class="topRow">
  <div class="hr"></div>

<div class="item" style="background: linear-gradient(135deg, rgba(103,232,249,.08), rgba(167,243,208,.05)); border-color:var(--accent);">
  <div class="topRow">
    <div style="font-weight:950; color:var(--accent);">ğŸ¯ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­</div>
  </div>
  
  <div class="two" style="margin-top:10px;">
    <div>
      <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨</label>
      <select id="targetHours">
        <option value="9-12">Ø®ÙÙŠÙ (9-12 Ø³Ø§Ø¹Ø©)</option>
        <option value="12-15" selected>Ù…ØªÙˆØ³Ø· (12-15 Ø³Ø§Ø¹Ø©)</option>
        <option value="15-18">Ø¶ØºØ· (15-18 Ø³Ø§Ø¹Ø©)</option>
        <option value="18+">ØªØ®Ø±Ø¬/Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰</option>
      </select>
    </div>
    <div>
      <label>ØªÙ†Ø²ÙŠÙ„ Ù…Ø®ØªØ¨Ø±Ø§Øª (Labs)ØŸ</label>
      <select id="labPref">
        <option value="yes" selected>Ù†Ø¹Ù…ØŒ Ù†Ø²Ù„ Ù„Ø§Ø¨Ø§Øª</option>
        <option value="no">Ù„Ø§ØŒ Ø¨Ø¯ÙˆÙ† Ù„Ø§Ø¨Ø§Øª Ù‡Ø§Ù„ÙØµÙ„</option>
        <option value="focus">Ø±ÙƒØ² Ø¹ Ø§Ù„Ù„Ø§Ø¨Ø§Øª Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©</option>
      </select>
    </div>
  </div>

  <div class="row" style="margin-top:12px;">
     <button class="btn" id="btnSmartSuggest" style="width:100%; background:var(--accent); color:#000; font-weight:bold; border:none;">
       ğŸ¤– Ø§Ù‚ØªØ±Ø­ Ù„ÙŠ Ø¬Ø¯ÙˆÙ„Ø§Ù‹ (AI Planner)
     </button>
  </div>
</div>

<div class="sep"></div>
<div class="list" id="suggestList"></div>

<div class="row" style="margin-top:12px;">
  <button class="btn primary" id="btnAddPlan" disabled>Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠØ©</button>
  <button class="btn" id="btnImportOfficial">ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø®Ø·Ø© Ø§Ù„ØªØ®ØµØµ</button>
</div>
</div>


          

            <div class="sep"></div>
          

            <div class="sep"></div>
            <div class="list" id="suggestList"></div>
          </div>
        </section>

        <aside class="card">
          <div class="hd">
            <h2 class="title">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®Ø·Ø©</h2>
            <p class="hint">Ù…ÙˆØ§Ø¯ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ (Ù…Ø´ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù„ÙŠ Ø£Ø®Ø°ØªÙ‡Ø§).</p>
          </div>
          <div class="body">
            <div class="list" id="planList">
              <div class="item"><div class="meta"</div></div>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <!-- COACH -->
    <div id="view_coach" class="hidden">
      <div class="grid">
        <section class="card">
          <div class="hd">
            <h2 class="title">Coach â€” Ù…ØªØ§Ø¨Ø¹Ø© Ø°ÙƒÙŠØ©</h2>
            <p class="hint">Ø§Ù‚ØªØ±Ø§Ø­ Ø³Ø±ÙŠØ¹ Ø´ØºØ§Ù„. Gemini Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø¥Ø°Ø§ Ø­Ø·ÙŠØª Ù…ÙØªØ§Ø­.</p>
          </div>
          <div class="body">
            <div class="item">
              <div class="topRow">
                <div style="font-weight:950">Ø³Ø¤Ø§Ù„ Ø³Ø±ÙŠØ¹</div>
                <div class="meta">Ø¨Ø¯ÙˆÙ† ØªØ¹Ù‚ÙŠØ¯</div>
              </div>
              <div class="hr"></div>

              <div class="two">
                <div>

               <div class="two">
  <div>
    <label>Ù†Ø±ÙƒØ² Ø¹Ù„Ù‰</label>
    <select id="coachFocus">
      <option value="weak">Ø£Ø¶Ø¹Ù Ù…Ø§Ø¯Ø©</option>
      <option value="tasks">Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ØªØ£Ø®Ø±Ø©</option>
      <option value="plan">Ø®Ø·Ø© Ø§Ù„ÙØµÙ„</option>
    </select>
  </div>
  <div>
    <label>Ø§Ù„Ø£Ø³Ù„ÙˆØ¨</label>
    <select id="coachStyle">
      <option value="easy" selected>Ø¨Ø³ÙŠØ· ÙˆÙ…Ø¨Ø§Ø´Ø±</option>
      <option value="strict">ØµØ§Ø±Ù… (Ø¬Ù„Ø¯)</option>
    </select>
  </div>
</div>

<div class="two" style="margin-top:12px;">
  <div>
    <label>Ø·ÙˆÙ„ Ø§Ù„Ø±Ø¯</label>
    <select id="coachLength">
      <option value="short" selected>Ù…Ø®ØªØµØ± (Ø§Ù„Ø²Ø¨Ø¯Ø©)</option>
      <option value="long">Ù…ÙØµÙ„ (Ø®Ø·Ø© ÙƒØ§Ù…Ù„Ø©)</option>
    </select>
  </div>
</div>

              <div style="margin-top:12px;">
                <label>Ø´Ùˆ Ù…Ø¶Ø§ÙŠÙ‚Ùƒ Ø§Ù„ÙŠÙˆÙ…ØŸ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <textarea id="coachInput" placeholder="Ù…Ø«Ø§Ù„: Ø®Ø§ÙŠÙ Ù…Ù† Ø§Ù…ØªØ­Ø§Ù† / Ù…ØªØ±Ø§ÙƒÙ… Ø¹Ù„ÙŠ ÙˆØ§Ø¬Ø¨Ø§Øª..."></textarea>
              </div>

              <div class="row" style="margin-top:12px;">
                <button class="btn primary" id="btnCoachAsk" disabled>Ø§Ø³Ø£Ù„ (Gemini)</button>
                <button class="btn" id="btnCoachQuick" disabled>Ø§Ù‚ØªØ±Ø§Ø­ Ø³Ø±ÙŠØ¹</button>
              </div>

              <div class="sep"></div>
              <div class="quote" id="coachAnswer">Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø£ÙˆÙ„Ø§Ù‹ âœ…</div>
            </div>
          </div>
        </section>

        <aside class="card">
          <div class="hd">
            <h2 class="title">Ù…Ù„Ø®ØµÙƒ</h2>
            <p class="hint">Ø£Ø¶Ø¹Ù Ù…Ø§Ø¯Ø© + Ø£Ù‚Ø±Ø¨ Ù…Ù‡Ù…Ø© + Ù†ØµÙŠØ­Ø© Ù‚ØµÙŠØ±Ø©</p>
          </div>
          <div class="body">
            <div class="list" id="coachSummary"></div>
          </div>
        </aside>
      </div>
    </div>

    <!-- SETTINGS -->
    <div id="view_settings" class="hidden">
      <div class="grid">
        <section class="card">
          <div class="hd">
            <h2 class="title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
            <p class="hint">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ø³ÙŠØ·Ø© ÙˆÙˆØ§Ø¶Ø­Ø©.</p>
          </div>
          <div class="body">

            <div class="item">
              <div class="topRow">
                <div style="font-weight:950">Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙŠ</div>
                <div class="meta">ØªÙ†Ø­ÙØ¸ Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ</div>
              </div>
              <div class="hr"></div>

              <div class="two">
                <div>
                  <label>Ø§Ù„Ø§Ø³Ù…</label>
                  <input id="pName" placeholder="Ù…Ø«Ø§Ù„: Mohammad"/>
                </div>
                <div>
                  <label>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                  <input id="pPhone" placeholder="Ù…Ø«Ø§Ù„: 07xxxxxxxx"/>
                </div>
              </div>

              <div class="two" style="margin-top:12px;">
                <div>
                  <label>Ø§Ù„ØªØ®ØµØµ</label>
                  <input id="pMajor" placeholder="Ù…Ø«Ø§Ù„: Computer Engineering"/>
                </div>
                <div>
                  <label>Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©</label>
                  <select id="pYear">
                    <option value="">â€”</option>
                    <option value="1">Ø£ÙˆÙ„Ù‰</option>
                    <option value="2">Ø«Ø§Ù†ÙŠØ©</option>
                    <option value="3">Ø«Ø§Ù„Ø«Ø©</option>
                    <option value="4">Ø±Ø§Ø¨Ø¹Ø©</option>
                    <option value="5">Ø®Ø§Ù…Ø³Ø©</option>
                  </select>
                </div>
              </div>

              <div class="two" style="margin-top:12px;">
                <div>
                  <label>Ø§Ù„ÙØµÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ</label>
                  <select id="pTerm">
                    <option value="">â€”</option>
                    <option value="1">ÙØµÙ„ 1</option>
                    <option value="2">ÙØµÙ„ 2</option>
                    <option value="3">ØµÙŠÙÙŠ</option>
                  </select>
                </div>
                <div>
                  <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                  <input id="pDob" type="date"/>
                </div>
              </div>
<div class="item">
  <div class="topRow">
    <div style="font-weight:950">Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ</div>
    <div class="meta">Ø­Ø¯Ø¯ Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„Ø¯Ø±Ø¬Ø©</div>
  </div>
  <div class="hr"></div>

  <div class="list" style="gap:15px; padding:0;">
    
    <div>
      <label><b>1. Ù‚Ø·Ø§Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…:</b></label>
      <select id="sectorSelect">
        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø§Ø¹ --</option>
        <option value="gov">Ø¬Ø§Ù…Ø¹Ø© Ø­ÙƒÙˆÙ…ÙŠØ©</option>
        <option value="pvt">Ø¬Ø§Ù…Ø¹Ø© Ø®Ø§ØµØ©</option>
      </select>
    </div>

    <div>
      <label><b>2. Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©:</b></label>
      <select id="universitySelect" disabled>
        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø£ÙˆÙ„Ø§Ù‹ --</option>
      </select>
    </div>

    <div>
      <label><b>3. Ø§Ù„ÙƒÙ„ÙŠØ©:</b></label>
      <select id="collegeSelect" disabled>
        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø£ÙˆÙ„Ø§Ù‹ --</option>
      </select>
    </div>

    <div>
      <label><b>4. Ø§Ù„ØªØ®ØµØµ:</b></label>
      <select id="majorSelect" disabled>
        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„ÙŠØ© Ø£ÙˆÙ„Ø§Ù‹ --</option>
      </select>
    </div>

    <div>
      <label><b>5. Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©:</b></label>
      <select id="degreeLevelSelect">
        <option value="bachelor" selected>Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³ (Bachelor)</option>
        <option value="diploma">Ø¯Ø¨Ù„ÙˆÙ… (Diploma)</option>
        <option value="master">Ù…Ø§Ø¬Ø³ØªÙŠØ± (Master's)</option>
        <option value="phd">Ø¯ÙƒØªÙˆØ±Ø§Ù‡ (PhD)</option>
      </select>
    </div>

  </div>
</div>
              <div class="row" style="margin-top:12px;">
                <button class="btn primary" id="btnSaveProfile" disabled>Ø­ÙØ¸</button>
                <span class="pill">Email Verified: <b id="emailVerified">â€”</b></span>
                <button class="btn ok" id="btnSendVerify" disabled>Ø¥Ø±Ø³Ø§Ù„ ØªØ­Ù‚Ù‚</button>
              </div>

              <div class="sep"></div>
              <div class="quote" id="profileMsg">Ù‚Ù… Ø¨Ø§Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© !</div>
            </div>

          </div>
        </section>

        <aside class="card">
          <div class="hd">
            <h2 class="title">Ø®ØµÙˆØµÙŠØ© Ø³Ø±ÙŠØ¹Ø©</h2>
            <p class="hint">Ù…Ø®ØªØµØ± ÙˆÙ…ÙÙŠØ¯</p>
          </div>
          <div class="body">
            <div class="quote">
              â€¢ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù†Øª Ø¨ØªØ´ÙˆÙÙ‡Ø§ Ø¨Ø­Ø³Ø§Ø¨Ùƒ ÙÙ‚Ø·.<br>
              â€¢ Ø³ÙŠØªÙ… ØªÙˆÙÙŠØ± Ø§Ù„Ø§ÙŠÙ…ÙŠÙ„Ø§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ© Ù‚Ø±ÙŠØ¨Ø§ .            </div>
          </div>
        </aside>

      </div>
    </div>

  </div><!-- /studentApp -->

  <!-- ================= ADMIN APP ================= -->
  <div id="adminApp" class="hidden">

    <div id="admin_home">
      <div class="grid">
        <section class="card">
          <div class="hd">
            <h2 class="title">Admin Dashboard</h2>
            <p class="hint">Ø£Ø±Ù‚Ø§Ù… Ø³Ø±ÙŠØ¹Ø© Ø¹Ù† Ø§Ù„Ù†Ø¸Ø§Ù….</p>
          </div>
          <div class="body">
            <div class="kpi">
              <div class="box"><div class="k">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨</div><div class="v" id="aUsers">â€”</div></div>
              <div class="box"><div class="k">Ø¢Ø®Ø± 7 Ø£ÙŠØ§Ù… (ØªÙ‚Ø±ÙŠØ¨ÙŠ)</div><div class="v" id="aActive">â€”</div></div>
              <div class="box"><div class="k">Ù…ØªÙˆØ³Ø· GPA (ØªÙ‚Ø±ÙŠØ¨ÙŠ)</div><div class="v" id="aAvgGpa">â€”</div></div>
            </div>
            <div class="sep"></div>
            <div class="quote" id="adminHomeMsg">Ø¥Ø°Ø§ Ù…Ø§ Ø¸Ù‡Ø± Ø´ÙŠØ¡: Ø±Ø§Ø¬Ø¹ Firestore Rules Ù„Ù„Ø£Ø¯Ù…Ù†.</div>
          </div>
        </section>

        <aside class="card">
          <div class="hd">
            <h2 class="title">Ø£Ø­Ø¯Ø« Ø§Ù„Ø·Ù„Ø§Ø¨</h2>
            <p class="hint">Ø¢Ø®Ø± Ù†Ø´Ø§Ø· (lastSeen)</p>
          </div>
          <div class="body">
            <div class="list" id="aRecent"></div>
          </div>
        </aside>
      </div>
    </div>

    <div id="admin_users" class="hidden">
      <div class="grid">
        <section class="card">
          <div class="hd">
            <h2 class="title">Ø§Ù„Ø·Ù„Ø§Ø¨ (Ø¨Ø­Ø« + Ø¬Ø¯ÙˆÙ„)</h2>
            <p class="hint">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ ØµÙ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„.</p>
          </div>
          <div class="body">

            <div class="two">
              <div>
                <label>Ø¨Ø­Ø« (Ø§Ø³Ù…/Ø¥ÙŠÙ…ÙŠÙ„/ØªØ®ØµØµ)</label>
                <input id="aQ" placeholder="mohammad / engineering / cs"/>
              </div>
              <div>
                <label>Ø§Ù„Ø³Ù†Ø©</label>
                <select id="aYear">
                  <option value="">Ø§Ù„ÙƒÙ„</option>
                  <option value="1">Ø£ÙˆÙ„Ù‰</option><option value="2">Ø«Ø§Ù†ÙŠØ©</option><option value="3">Ø«Ø§Ù„Ø«Ø©</option><option value="4">Ø±Ø§Ø¨Ø¹Ø©</option><option value="5">Ø®Ø§Ù…Ø³Ø©</option>
                </select>
              </div>
            </div>

            <div class="two" style="margin-top:12px;">
              <div>
                <label>ÙØ±Ø²</label>
                <select id="aSort">
                  <option value="lastSeen_desc" selected>Ø§Ù„Ø£Ø­Ø¯Ø« Ù†Ø´Ø§Ø·Ù‹Ø§</option>
                  <option value="created_desc">Ø§Ù„Ø£Ø­Ø¯Ø« ØªØ³Ø¬ÙŠÙ„Ù‹Ø§</option>
                </select>
              </div>
              <div style="display:flex;gap:10px;align-items:flex-end;">
                <button class="btn primary" id="btnAdminRefresh" disabled>ØªØ­Ø¯ÙŠØ«</button>
                <span class="pill">Selected: <b id="aSel">â€”</b></span>
              </div>
            </div>

            <div class="sep"></div>

            <div class="item">
              <div class="topRow">
                <div style="font-weight:950">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</div>
                <div class="meta">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ ØµÙ</div>
              </div>
              <div class="hr"></div>

              <div style="overflow:auto">
                <table>
                  <thead>
                    <tr>
                      <th>Ø§Ù„Ø§Ø³Ù…</th>
                      <th>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</th>
                      <th>Ø§Ù„ØªØ®ØµØµ</th>
                      <th>Ø§Ù„Ø³Ù†Ø©</th>
                      <th>Ø¢Ø®Ø± Ù†Ø´Ø§Ø·</th>
                    </tr>
                  </thead>
                  <tbody id="aTableBody"></tbody>
                </table>
              </div>
            </div>

          </div>
        </section>

        <aside class="card">
          <div class="hd">
            <h2 class="title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</h2>
            <p class="hint">Profile + Ø¢Ø®Ø± Ù…Ù‡Ø§Ù…/Ù…ÙˆØ§Ø¯ (Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)</p>
          </div>
          <div class="body">
            <div class="list" id="aDetails"></div>
          </div>
        </aside>

      </div>
    </div>

    <div id="admin_settings" class="hidden">
      <div class="grid">
        <section class="card">
          <div class="hd">
            <h2 class="title">Admin Settings</h2>
            <p class="hint">Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª Verify/Reset Ù…Ù† Firebase Auth Ø¬Ø§Ù‡Ø²Ø©.</p>
          </div>
          <div class="body">
            <div class="quote">
              âœ… Email Verification / Reset Password Ø´ØºØ§Ù„ÙŠÙ† Ù…Ù† Firebase Auth Ù…Ø¨Ø§Ø´Ø±Ø©.<br>
              âš ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø¥ÙŠÙ…ÙŠÙ„Ø§Øª Ù†Ø¸Ø§Ù…/Ø¯ÙˆØ±ÙŠØ© Ø§Ù„Ø£ÙØ¶Ù„ Ø¹Ø¨Ø± Cloud Functions (Ù„Ø£Ù† API Key Ø¯Ø§Ø®Ù„ HTML Ø®Ø·Ø±).
            </div>

            <div class="sep"></div>

            <div class="item">
              <div class="topRow">
                <div style="font-weight:950">Gemini Key (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</div>
                <div class="meta">Coach ÙŠØ³ØªØ®Ø¯Ù…Ù‡ Ø¥Ø°Ø§ Ø­Ø·ÙŠØªÙ‡</div>
              </div>
              <div class="hr"></div>
              <div class="quote">
                Ø¶Ø¹ Ù…ÙØªØ§Ø­ Gemini Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù…ÙƒØ§Ù†Ù‡ (Ù…ØªØºÙŠØ± GEMINI_API_KEY).<br>
                Ù„Ù„Ø¥Ù†ØªØ§Ø¬: Ø§Ù„Ø£ÙØ¶Ù„ Proxy/Functions Ø¨Ø¯Ù„ ÙˆØ¶Ø¹ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¯Ø§Ø®Ù„ HTML.
              </div>
            </div>

          </div>
        </section>

        <aside class="card">
          <div class="hd">
            <h2 class="title">Ù…Ø¹Ù„ÙˆÙ…Ø©</h2>
            <p class="hint">Ø§Ù„Ø£Ø¯Ù…Ù† Ù…Ø­Ø¯Ø¯ Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</p>
          </div>
          <div class="body">
            <div class="quote">
              Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù‡ÙˆÙ† Ù…Ø­Ø¯Ø¯ Ø¨Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯ (MAIN_ADMIN_EMAIL).<br>
              Ø¥Ø°Ø§ Ø§Ù„Ù€ Rules ØªÙ…Ù†Ø¹ Ù‚Ø±Ø§Ø¡Ø© users/* Ù„Ù„Ø£Ø¯Ù…Ù† â†’ Ù…Ø´ Ø±Ø­ ÙŠØ·Ù„Ø¹ Ø´ÙŠØ¡.
            </div>
          </div>
        </aside>
      </div>
    </div>

  </div><!-- /adminApp -->

</div>

<div class="toast" id="toast"></div>

<!-- AUTH MODAL -->
<div id="authBack" class="modalBack">
  <div class="modal">
    <div class="modalHd">
      <h2 class="title" id="authTitle">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
      <p class="hint" id="authHint">Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø±Ø­ ØªÙˆØµÙ„Ùƒ Ø±Ø³Ø§Ù„Ø© ØªØ­Ù‚Ù‚ Ù„Ù„Ø¥ÙŠÙ…ÙŠÙ„.</p>
    </div>
    <div class="modalBody">
      <div class="two">
        <div>
          <label>Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</label>
          <input id="authEmail" type="email" placeholder="name@example.com"/>
        </div>
        <div>
          <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
          <input id="authPass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/>
        </div>
      </div>

      <div id="authNameWrap" class="two hidden" style="margin-top:12px;">
        <div style="grid-column:1 / -1;">
          <label>Ø§Ø³Ù…Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="authName" placeholder="Ù…Ø«Ø§Ù„: Mohammad"/>
        </div>
      </div>

      <div class="sep"></div>

      <div class="mini">
        <span id="authSwitchText">Ù…Ø´ Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ</span>
        <button class="ghostBtn" id="btnSwitchMode">Ø§Ø¹Ù…Ù„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</button>
        <span> Â· </span>
        <button class="ghostBtn" id="btnForgot">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±ØŸ</button>
      </div>

      <div class="sep"></div>
      <div class="quote" id="authMsg">
        Ù„Ø§Ø²Ù… ØªÙØ¹Ù‘Ù„ <b>Email/Password</b> Ù…Ù† Firebase â†’ Authentication.
      </div>
    </div>
    <div class="modalFooter">
      <button class="btn" id="btnAuthTips">ØªÙ„Ù…ÙŠØ­</button>
      <button class="btn primary" id="btnAuthGo">Ø¯Ø®ÙˆÙ„</button>
    </div>
  </div>
</div>

<script type="module">
  // =========================
  // Firebase (Modular v10)
  // =========================
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import {
    getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword,
    sendPasswordResetEmail, signOut, updateProfile, sendEmailVerification
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";

  import {
    getFirestore,
    doc, getDoc, setDoc, addDoc, deleteDoc, updateDoc,
    collection, query, orderBy, limit, onSnapshot, getDocs, where,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
const JORDAN_UNIVERSITIES = {
  "JU": { name: "Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠØ©", system: "4.0", symbols: ["A", "A-", "B+", "B", "B-", "C+", "C", "C-", "D+", "D", "D-", "F"] },
  "JUST": { name: "Ø§Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ (JUST)", system: "4.2", symbols: ["A+", "A", "A-", "B+", "B", "B-", "C+", "C", "C-", "D+", "D", "F"] }, // Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¯ÙŠØ« ØµØ§Ø± 4.0 Ø¨Ø³ Ø§Ù„Ù‚Ø¯ÙŠÙ… 4.2
  "HU": { name: "Ø§Ù„Ù‡Ø§Ø´Ù…ÙŠØ©", system: "4.0", symbols: ["A+", "A", "A-", "B+", "B", "B-", "C+", "C", "C-", "D+", "D", "F"] },
  "YU": { name: "Ø§Ù„ÙŠØ±Ù…ÙˆÙƒ", system: "pct", symbols: [] }, // Ù…Ø¦ÙˆÙŠ
  "BAU": { name: "Ø§Ù„Ø¨Ù„Ù‚Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠØ©", system: "4.0", symbols: ["A", "A-", "B+", "B", "B-", "C+", "C", "C-", "D+", "D", "D-", "F"] },
  "AABU": { name: "Ø¢Ù„ Ø§Ù„Ø¨ÙŠØª", system: "pct", symbols: [] }, // Ù…Ø¦ÙˆÙŠ (Ø£Ùˆ Ø­Ø³Ø¨ Ø§Ù„ØªØ®ØµØµ)
  "GJU": { name: "Ø§Ù„Ø£Ù„Ù…Ø§Ù†ÙŠØ© Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠØ©", system: "gju", symbols: ["0.7", "1.0", "1.3", "1.7", "2.0", "2.3", "2.7", "3.0", "3.3", "3.7", "4.0", "5.0"] } // Ù†Ø¸Ø§Ù… Ø£Ù„Ù…Ø§Ù†ÙŠ Ù…Ø¹ÙƒÙˆØ³
};
  // =========================
  // CONFIG (Ø¶Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø´Ø±ÙˆØ¹Ùƒ)
  // =========================
const firebaseConfig = {
  apiKey: "AIzaSyAUAcDdEikDwipXktN6VGuDQOi4Ov9RHOI",
  authDomain: "codenexus-c89ac.firebaseapp.com",
  projectId: "codenexus-c89ac",
  storageBucket: "codenexus-c89ac.firebasestorage.app",
  messagingSenderId: "976765621106",
  appId: "1:976765621106:web:902b06a82a7437e80643eb",
  measurementId: "G-H9D48DRM84"
};

  // Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
  const MAIN_ADMIN_EMAIL = "m3.l0.direct@gmail.com";

  // âœ… Gemini API (Ù…ÙˆØ­Ù‘Ø¯) â€” Ø§Ø®ØªÙŠØ§Ø±ÙŠ
  const GEMINI_API_KEY = "AIzaSyBJeWYBLH1FIq3w3J2kEZxyc4jO41E0qvc";
  const GEMINI_MODEL = "gemini-2.5-flash";
  const GEMINI_ENDPOINT = `https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${encodeURIComponent(GEMINI_API_KEY)}`;

  // =========================
  // Helpers
  // =========================
  const $ = (id) => document.getElementById(id);
  const toastEl = $("toast");

  function toast(msg, isErr=false){
    if(!toastEl){ alert(msg); return; }
    toastEl.textContent = msg;
    toastEl.style.borderColor = isErr ? "rgba(251,113,133,.45)" : "rgba(103,232,249,.35)";
    toastEl.classList.add("show");
    setTimeout(()=>toastEl.classList.remove("show"), 3500);
  }

  function must(id){
    const el = $(id);
    if(!el) throw new Error("Missing element: #" + id);
    return el;
  }

  function esc(s){
    return String(s ?? "")
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }

  function ymd(date = new Date()){
    const d = new Date(date);
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    return `${y}-${m}-${dd}`;
  }

  function addDaysYMD(baseYMD, days){
    const [y,m,d] = baseYMD.split("-").map(Number);
    const dt = new Date(y, m-1, d);
    dt.setDate(dt.getDate()+days);
    return ymd(dt);
  }

  function nowISO(){ return new Date().toISOString(); }

  // =========================
  // Init
  // =========================
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // =========================
  // UI Elements (Auth)
  // =========================
  const authBack = must("authBack");
  const btnGo = must("btnAuthGo");
  const btnSwitch = must("btnSwitchMode");
  const btnForgot = must("btnForgot");
  const btnTips = must("btnAuthTips");

  const btnLogout = $("btnLogout");
  const userLabel = $("userLabel");
  const roleLabel = $("roleLabel");

  // Apps
  const studentApp = $("studentApp");
  const adminApp   = $("adminApp");
  const studentTabs = $("studentTabs");
  const adminTabs   = $("adminTabs");

  // Buttons
  const btnOpenSettings = $("btnOpenSettings");
  const btnBackup = $("btnBackup");
  const btnRestore = $("btnRestore");

  // =========================
  // Tabs switching
  // =========================
  function showStudentView(view){
    ["tasks","gpa","planner","coach","settings"].forEach(v=>{
      const el = $("view_" + v);
      if(el) el.classList.toggle("hidden", v !== view);
    });
    document.querySelectorAll("#studentTabs .tab").forEach(t=>{
      t.classList.toggle("active", t.dataset.view === view);
    });
  }
  function showAdminView(view){
    ["admin_home","admin_users","admin_settings"].forEach(v=>{
      const el = $(v);
      if(el) el.classList.toggle("hidden", v !== view);
    });
    document.querySelectorAll("#adminTabs .tab").forEach(t=>{
      t.classList.toggle("active", t.dataset.adminview === view);
    });
  }

  document.querySelectorAll("#studentTabs .tab").forEach(t=>{
    t.addEventListener("click", ()=> showStudentView(t.dataset.view));
  });
  document.querySelectorAll("#adminTabs .tab").forEach(t=>{
    t.addEventListener("click", ()=> showAdminView(t.dataset.adminview));
  });

  if(btnOpenSettings){
    btnOpenSettings.addEventListener("click", ()=>{
      if(!auth.currentUser) return;
      const isAdmin = (auth.currentUser.email||"").toLowerCase() === MAIN_ADMIN_EMAIL.toLowerCase();
      if(isAdmin) showAdminView("admin_settings");
      else showStudentView("settings");
      toast("ØªÙ… ÙØªØ­ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âœ…");
    });
  }

  // =========================
  // Auth Mode
  // =========================
  let authMode = "login";
  function setAuthMode(mode){
    authMode = mode;
    const isSignup = mode === "signup";

    $("authTitle").textContent = isSignup ? "Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨" : "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„";
    $("authHint").textContent  = isSignup
      ? "Ø§Ø¹Ù…Ù„ Ø­Ø³Ø§Ø¨ Ø¨Ø¥ÙŠÙ…ÙŠÙ„Ùƒ. Ø¨Ø¹Ø¯ÙŠÙ† Ù„Ø§Ø²Ù… ØªØ¹Ù…Ù„ ØªØ­Ù‚Ù‚ (Verify Email)."
      : "Ø§Ø¯Ø®Ù„ Ø¥ÙŠÙ…ÙŠÙ„Ùƒ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±.";

    btnGo.textContent = isSignup ? "Ø¥Ù†Ø´Ø§Ø¡" : "Ø¯Ø®ÙˆÙ„";
    $("authNameWrap").classList.toggle("hidden", !isSignup);
    $("authSwitchText").textContent = isSignup ? "Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ" : "Ù…Ø´ Ø¹Ù†Ø¯Ùƒ Ø­Ø³Ø§Ø¨ØŸ";
    btnSwitch.textContent  = isSignup ? "Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„" : "Ø§Ø¹Ù…Ù„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯";
  }
  setAuthMode("login");

  btnSwitch.addEventListener("click", () => setAuthMode(authMode === "login" ? "signup" : "login"));

  btnTips.addEventListener("click", ()=>{
    $("authMsg").innerHTML =
      "1) Firebase â†’ Authentication â†’ ÙØ¹Ù‘Ù„ Email/Password<br>" +
      "2) Firestore Database â†’ Ø£Ù†Ø´Ø¦ Ù‚Ø§Ø¹Ø¯Ø© + Ø¶Ø¹ Rules<br>" +
      "3) Ø¥Ù† ÙƒÙ†Øª Ø¹Ù„Ù‰ Spark (Ù…Ø¬Ø§Ù†ÙŠ): Firestore Ù…Ø¬Ø§Ù†ÙŠ Ø¶Ù…Ù† Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù….";
    toast("ØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ØªÙ„Ù…ÙŠØ­ âœ…");
  });

  btnForgot.addEventListener("click", async ()=>{
    const email = $("authEmail").value.trim();
    if(!email){ toast("Ø§ÙƒØªØ¨ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹.", true); return; }
    try{
      await sendPasswordResetEmail(auth, email);
      toast("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† âœ…");
    }catch(e){
      console.error(e);
      toast("ØªØ¹Ø°Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„. ØªØ£ÙƒØ¯ Ù…Ù† Email/Password.", true);
    }
  });

  btnGo.addEventListener("click", async ()=>{
    const email = $("authEmail").value.trim();
    const pass  = $("authPass").value;
    if(!email || !pass){ toast("Ø§ÙƒØªØ¨ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±.", true); return; }

    btnGo.disabled = true;
    try{
      if(authMode === "login"){
        await signInWithEmailAndPassword(auth, email, pass);
        toast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
      }else{
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        const name = ($("authName").value || "").trim();
        if(name){
          try{ await updateProfile(cred.user, { displayName: name }); }catch(_){}
        }
        try{ await sendEmailVerification(cred.user); }catch(_){}
        toast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ… ØªÙÙ‚Ø¯ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù„Ù„ØªØ­Ù‚Ù‚");
        setAuthMode("login");
      }
    }catch(e){
      console.error(e);
      const code = e?.code || "";
      const msg =
        code === "auth/invalid-credential" ? "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙ„Ø·." :
        code === "auth/email-already-in-use" ? "Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù…." :
        code === "auth/weak-password" ? "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø¶Ø¹ÙŠÙØ© (6+)." :
        (e?.message || "Ø®Ø·Ø£.");
      toast(msg, true);
    }finally{
      btnGo.disabled = false;
    }
  });

  if(btnLogout){
    btnLogout.addEventListener("click", async ()=>{
      try{ await signOut(auth); toast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ âœ…"); }
      catch(e){ console.error(e); toast("ØªØ¹Ø°Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬.", true); }
    });
  }

  function resetGuestUI(){
    if(userLabel) userLabel.textContent = "ØºÙŠØ± Ù…Ø³Ø¬Ù‘Ù„";
    if(roleLabel) roleLabel.textContent = "â€”";
    authBack.classList.remove("hidden");
    studentApp?.classList.add("hidden");
    adminApp?.classList.add("hidden");
    studentTabs?.classList.add("hidden");
    adminTabs?.classList.add("hidden");
    btnOpenSettings && (btnOpenSettings.disabled = true);
    btnBackup && (btnBackup.disabled = true);
    btnRestore && (btnRestore.disabled = true);
    btnLogout && (btnLogout.disabled = true);
  }

  // =========================
  // Firestore refs
  // =========================
  const userDoc = (uid)=>doc(db, "users", uid);
  const tasksCol = (uid)=>collection(db, "users", uid, "tasks");
  const takenCol = (uid)=>collection(db, "users", uid, "taken");
  const planCol  = (uid)=>collection(db, "users", uid, "plan");

  // =========================
  // Ensure user root doc
  // =========================
  async function ensureUserRoot(user){
    const ref = userDoc(user.uid);
    const snap = await getDoc(ref);

    const base = {
      email: user.email || null,
      displayName: user.displayName || null,
      emailVerified: !!user.emailVerified,
      lastSeen: nowISO()
    };

    if(!snap.exists()){
      await setDoc(ref, {
        ...base,
        createdAt: serverTimestamp(),
        profile: { name: user.displayName || "", major:"", year:"", term:"", phone:"", dob:"" }
      }, { merge:true });
    }else{
      await setDoc(ref, base, { merge:true });
    }
  }

  // =========================
  // Backup / Restore (JSON)
  // =========================
  async function buildBackup(uid){
    const [tSnap, gSnap, pSnap] = await Promise.all([
      getDocs(query(tasksCol(uid), orderBy("createdAt","desc"))),
      getDocs(query(takenCol(uid), orderBy("createdAt","desc"))),
      getDocs(query(planCol(uid),  orderBy("createdAt","desc")))
    ]);

    const tasks = tSnap.docs.map(d=>({id:d.id, ...d.data()}));
    const taken = gSnap.docs.map(d=>({id:d.id, ...d.data()}));
    const plan  = pSnap.docs.map(d=>({id:d.id, ...d.data()}));

    const u = await getDoc(userDoc(uid));
    const profile = u.exists() ? (u.data()?.profile || {}) : {};

    return { version: 1, exportedAt: nowISO(), profile, tasks, taken, plan };
  }

  function downloadJson(obj, filename){
    const blob = new Blob([JSON.stringify(obj, null, 2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = filename;
    document.body.appendChild(a);
    a.click();
    a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1000);
  }

  function pickJsonFile(){
    return new Promise((resolve)=>{
      const inp = document.createElement("input");
      inp.type = "file";
      inp.accept = "application/json";
      inp.onchange = ()=> resolve(inp.files?.[0] || null);
      inp.click();
    });
  }

  async function restoreBackup(uid, data){
    if(!data || typeof data !== "object") throw new Error("bad_backup");

    // profile
    if(data.profile){
      await setDoc(userDoc(uid), { profile: data.profile, lastSeen: nowISO() }, { merge:true });
    }

    // tasks
    if(Array.isArray(data.tasks)){
      for(const t of data.tasks){
        const { id, ...rest } = t;
        await addDoc(tasksCol(uid), {
          title: rest.title||"",
          course: rest.course||"",
          dueYMD: rest.dueYMD||"",
          minutes: Number(rest.minutes||60),
          prio: rest.prio||"med",
          type: rest.type||"assignment",
          notes: rest.notes||"",
          done: !!rest.done,
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        });
      }
    }

    // taken
    if(Array.isArray(data.taken)){
      for(const c of data.taken){
        const { id, ...rest } = c;
        await addDoc(takenCol(uid), {
          name: rest.name||"",
          credits: Number(rest.credits||3),
          grade: rest.grade||"",
          cat: rest.cat||"major",
          pointsMin: Number(rest.pointsMin||0),
          pointsMax: Number(rest.pointsMax||0),
          createdAt: serverTimestamp()
        });
      }
    }

    // plan
    if(Array.isArray(data.plan)){
      for(const c of data.plan){
        const { id, ...rest } = c;
        await addDoc(planCol(uid), {
          code: rest.code||"",
          name: rest.name||"",
          credits: Number(rest.credits||3),
          cat: rest.cat||"major",
          prereq: Array.isArray(rest.prereq) ? rest.prereq : [],
          createdAt: serverTimestamp()
        });
      }
    }
  }

  btnBackup?.addEventListener("click", async ()=>{
    const u = auth.currentUser;
    if(!u) return;
    try{
      const backup = await buildBackup(u.uid);
      downloadJson(backup, `unipilot-backup-${u.uid.slice(0,6)}.json`);
      toast("ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± âœ…");
    }catch(e){
      console.error(e);
      toast("ÙØ´Ù„ Ø§Ù„ØªØµØ¯ÙŠØ±.", true);
    }
  });

  btnRestore?.addEventListener("click", async ()=>{
    const u = auth.currentUser;
    if(!u) return;
    try{
      const f = await pickJsonFile();
      if(!f) return;
      const txt = await f.text();
      const data = JSON.parse(txt);
      await restoreBackup(u.uid, data);
      toast("ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ âœ…");
    }catch(e){
      console.error(e);
      toast("ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…Ù„Ù.", true);
    }
  });

  // =========================
  // TASKS (FIXED: saves + shows instantly)
  // =========================
  let currentTaskFilter = "all";   // âœ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ: Ø§Ù„ÙƒÙ„ (Ø¹Ø´Ø§Ù† Ù…Ø§ ØªØ®ØªÙÙŠ Ø§Ù„Ù…Ù‡Ø§Ù…)
  let _tasksCache = [];
  let _unsubTasks = null;

  function parseDue(dueYMD){
    if(!dueYMD) return null;
    const [y,m,d] = dueYMD.split("-").map(Number);
    if(!y || !m || !d) return null;
    return new Date(y, m-1, d, 23, 59, 59);
  }

  function taskStatusBadge(t){
    const due = parseDue(t.dueYMD);
    const done = !!t.done;
    if(done) return `<span class="badge ok">Ù…Ù†Ø¬Ø²Ø©</span>`;
    if(due && new Date() > due) return `<span class="badge danger">Ù…ØªØ£Ø®Ø±Ø©</span>`;
    if(t.prio === "high") return `<span class="badge warn">Ø¹Ø§Ù„ÙŠØ©</span>`;
    if(t.prio === "low") return `<span class="badge">Ù…Ù†Ø®ÙØ¶Ø©</span>`;
    return `<span class="badge">Ù…ØªÙˆØ³Ø·Ø©</span>`;
  }

  function filterTasks(list){
    const today = ymd();
    const weekEnd = addDaysYMD(today, 7);

    if(currentTaskFilter === "all") return list;

    if(currentTaskFilter === "today"){
      return list.filter(t=> t.dueYMD === today );
    }

    if(currentTaskFilter === "week"){
      return list.filter(t=>{
        if(!t.dueYMD) return false;
        return t.dueYMD >= today && t.dueYMD <= weekEnd;
      });
    }

    if(currentTaskFilter === "over"){
      return list.filter(t=>{
        const due = parseDue(t.dueYMD);
        return !t.done && due && new Date() > due;
      });
    }

    return list;
  }

  function updateTaskKPIs(all){
    const today = ymd();
    const weekEnd = addDaysYMD(today, 7);

    const todayCount = all.filter(t=> t.dueYMD === today && !t.done).length;
    const weekCount  = all.filter(t=> t.dueYMD && t.dueYMD >= today && t.dueYMD <= weekEnd && !t.done).length;

    const weekAll = all.filter(t=> t.dueYMD && t.dueYMD >= today && t.dueYMD <= weekEnd);
    const doneCount = weekAll.filter(t=> !!t.done).length;
    const donePct = weekAll.length ? Math.round((doneCount / weekAll.length)*100) : 0;

    $("kToday").textContent = String(todayCount);
    $("kWeek").textContent  = String(weekCount);
    $("kDonePct").textContent = weekAll.length ? (donePct + "%") : "â€”";
  }

  function renderTasks(uid, all){
    const list = filterTasks(all);
    const wrap = $("taskList");
    if(!wrap) return;

    if(!list.length){
      wrap.innerHTML = `<div class="item"><div class="meta">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ø­Ø§Ù„ÙŠ.</div></div>`;
      return;
    }

    // sort: due asc, then created
    const sorted = [...list].sort((a,b)=>{
      const da = a.dueYMD || "9999-12-31";
      const db = b.dueYMD || "9999-12-31";
      if(da !== db) return da < db ? -1 : 1;
      const ca = a.createdAt?.seconds || 0;
      const cb = b.createdAt?.seconds || 0;
      return cb - ca;
    });

    wrap.innerHTML = sorted.map(t=>{
      return `
        <div class="item">
          <div class="topRow">
            <div style="font-weight:950">${esc(t.title||"")}</div>
            <div>${taskStatusBadge(t)}</div>
          </div>
          <div class="hr"></div>
          <div class="meta">
            ${t.course ? `ğŸ“Œ ${esc(t.course)} Â· ` : ""}
            ${t.type ? `ğŸ§© ${esc(t.type)} Â· ` : ""}
            â± ${Number(t.minutes||60)} Ø¯Ù‚ÙŠÙ‚Ø©
            ${t.dueYMD ? ` Â· ğŸ“… ${esc(t.dueYMD)}` : ""}
          </div>
          ${t.notes ? `<div class="hr"></div><div class="meta">${esc(t.notes)}</div>` : ""}

          <div class="hr"></div>
          <div class="actions">
            <button class="btn smallBtn ok" data-act="toggle" data-id="${esc(t.id)}">${t.done ? "Ø¥Ø±Ø¬Ø§Ø¹" : "ØªÙ… âœ…"}</button>
            <button class="btn smallBtn danger" data-act="del" data-id="${esc(t.id)}">Ø­Ø°Ù</button>
          </div>
        </div>
      `;
    }).join("");

    // bind actions
    wrap.querySelectorAll("button[data-act]").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        const act = btn.dataset.act;
        const id = btn.dataset.id;
        try{
          if(act === "del"){
            if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù‡Ù…Ø©ØŸ")) return;
            await deleteDoc(doc(db, "users", uid, "tasks", id));
            toast("ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…");
          }else if(act === "toggle"){
            const item = _tasksCache.find(x=>x.id === id);
            if(!item) return;
            await updateDoc(doc(db, "users", uid, "tasks", id), {
              done: !item.done,
              updatedAt: serverTimestamp()
            });
            toast("ØªÙ… âœ…");
          }
        }catch(e){
          console.error(e);
          toast("ØªØ¹Ø°Ø± ØªÙ†ÙÙŠØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.", true);
        }
      });
    });
  }

  function startTasksListener(uid){
    if(_unsubTasks) _unsubTasks();
    const qy = query(tasksCol(uid), orderBy("createdAt","desc"));
    _unsubTasks = onSnapshot(qy, (snap)=>{
      const all = snap.docs.map(d=>({ id:d.id, ...d.data() }));
      _tasksCache = all;                // âœ… cache
      renderTasks(uid, _tasksCache);    // âœ… render always
      updateTaskKPIs(_tasksCache);
      updateTodayPlanMsg();
      updateCoachSummary();
    }, (err)=>{
      console.error(err);
      toast("Ù…Ø´ÙƒÙ„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù‡Ø§Ù…. Ø±Ø§Ø¬Ø¹ Rules.", true);
    });
  }

  // filter buttons (instant render)
  ["fToday","fWeek","fAll","fOver"].forEach(id=>{
    const el = $(id);
    if(!el) return;
    el.addEventListener("click", ()=>{
      currentTaskFilter = el.dataset.f;
      document.querySelectorAll("#taskSeg .segBtn").forEach(b=> b.classList.toggle("active", b === el));
      const u = auth.currentUser;
      if(!u) return;
      renderTasks(u.uid, _tasksCache);
    });
  });
// ==========================================
// ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ©
// ==========================================
$("btnImportOfficial")?.addEventListener("click", async () => {
  const u = auth.currentUser; if(!u) return;

  // 1. Ù…Ø¹Ø±ÙØ© ØªØ®ØµØµ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù† Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„
  // Ù†Ø­ØªØ§Ø¬ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹ (Ø£Ùˆ Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ØªØ§Ø­Ø©)
  // Ù„Ù„Ø£Ù…Ø§Ù†ØŒ Ø³Ù†Ù‚Ø±Ø£ Ù…Ù† Firestore Ù…Ø¨Ø§Ø´Ø±Ø©
  const snap = await getDoc(userDoc(u.uid));
  const p = snap.data()?.profile || {};

  // ØªÙƒÙˆÙŠÙ† Ø§Ù„Ù…ÙØªØ§Ø­: University_College_Major
  // Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ¬Ø¨ Ø£Ù† ØªØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙŠ OFFICIAL_PLANS ØªÙ…Ø§Ù…Ø§Ù‹
  // Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø¯Ø§Ù„Ø© ØªÙ†Ø¸ÙŠÙ Ø¨Ø³ÙŠØ·Ø© Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ·Ø§Ø¨Ù‚ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
  
  // ÙÙŠ Ù…Ø«Ø§Ù„Ù†Ø§: Ø§Ù„Ù…ÙØªØ§Ø­ Ù‡Ùˆ AABU_IT_Ø¹Ù„Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ø­Ø³Ø¨ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®Ø²Ù†Ø© ÙÙŠ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…)
  // Ù„ÙƒÙ† Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… ØªØ±Ø¬Ø¹ "Data Science..." Ø¨Ø§Ù„Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø£Ùˆ Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ø­Ø³Ø¨ Ù…Ø§ Ø¨Ø±Ù…Ø¬Ù†Ø§ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹
  // Ù„Ù†ÙØªØ±Ø¶ Ø£Ù†Ù†Ø§ Ø®Ø²Ù†Ø§ Ø§Ù„Ø§Ø³Ù… ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©:
  
  // ØªØ°ÙƒÙŠØ±: ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ÙƒØ§Ù† Ø§Ù„Ù…ÙØªØ§Ø­ "AABU" ÙˆØ§Ù„ÙƒÙ„ÙŠØ© "IT" ÙˆØ§Ù„ØªØ®ØµØµ "Ø¹Ù„Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..."
  const planKey = `${$("universitySelect").value}_${$("collegeSelect").value}_${$("majorSelect").value}`;
  
  // Ø¨Ø­Ø« ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
  // Ù‡Ù†Ø§ Ø³Ù†Ø³ØªØ®Ø¯Ù… Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… (AABU, IT) + Ø§Ø³Ù… Ø§Ù„ØªØ®ØµØµ
  // Ù„Ø°Ø§ ÙŠØ¬Ø¨ Ø§Ù„ØªØ£ÙƒØ¯ Ø£Ù† OFFICIAL_PLANS ØªØ³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ù€ Keys
  
  // Ø­Ù„ Ø³Ø±ÙŠØ¹: Ø³Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ù€ Dropdowns Ù„Ø£Ù†Ù‡Ø§ Ù‡ÙŠ Ù…Ø§ ÙŠØ­Ø¯Ø¯ Ø§Ù„ØªØ®ØµØµ
// ... Ø¯Ø§Ø®Ù„ Ø²Ø± btnImportOfficial ...

// 1. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ù†ÙØ³ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
// Key format: University_College_Major (All English values now)
const selectedUni = $("universitySelect").value; // "AABU"
const selectedCol = $("collegeSelect").value;    // "IT"
const selectedMaj = $("majorSelect").value;      // "Data Science and AI"

const key = `${selectedUni}_${selectedCol}_${selectedMaj}`;

// 2. Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… window.OFFICIAL_PLANS
const officialPlan = window.OFFICIAL_PLANS ? window.OFFICIAL_PLANS[key] : null;

// ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„ÙƒÙˆØ¯ ÙƒÙ…Ø§ Ù‡Ùˆ ...
  if (!officialPlan) {
    toast(`Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© Ù„Ù‡Ø°Ø§ Ø§Ù„ØªØ®ØµØµ (${key}) ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© ÙÙŠ Ø§Ù„Ù†Ø¸Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹.`, true);
    return;
  }

  if(!confirm("Ø³ÙŠØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ù…ÙˆØ§Ø¯ Ø§Ù„Ø®Ø·Ø© Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ. Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ")) return;

  // Ø§Ù„Ø¨Ø¯Ø¡ Ø¨Ø§Ù„Ù†Ø³Ø®
  let count = 0;
  try {
    // Loop through Years -> Semesters -> Courses
    for (const year in officialPlan) {
      for (const sem in officialPlan[year]) {
        const courses = officialPlan[year][sem];
        for (const c of courses) {
          // Ù†Ø¶ÙŠÙ Ø§Ù„Ù…Ø§Ø¯Ø© Ù„Ù„Ù€ Plan ÙÙŠ Firebase
          // Ù†ØªØ£ÙƒØ¯ Ø£ÙˆÙ„Ø§Ù‹ Ø£Ù†Ù‡Ø§ ØºÙŠØ± Ù…Ø¶Ø§ÙØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ø¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±ØŒ Ù„ÙƒÙ† Ø§Ù„Ù€ Firestore ÙŠÙˆÙ„Ø¯ ID Ø¹Ø´ÙˆØ§Ø¦ÙŠ)
          // Ø§Ù„Ø£ÙØ¶Ù„ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…ØŒ Ù„ÙƒÙ† Ù„Ù„Ø³Ø±Ø¹Ø© Ø³Ù†Ø¶ÙŠÙÙ‡Ø§
          
          await addDoc(planCol(u.uid), {
            code: c.code,
            name: c.name,
            credits: c.credits,
            prereq: c.prereq, // Ù…ØµÙÙˆÙØ© Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
            suggestedYear: year, // Ù†Ø®Ø²Ù† Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø© (Ø³Ù†Ø© 1ØŒ Ø³Ù†Ø© 2)
            suggestedSem: sem,   // Ù†Ø®Ø²Ù† Ø§Ù„ÙØµÙ„ Ø§Ù„Ù…Ù‚ØªØ±Ø­
            cat: "major", // Ø§ÙØªØ±Ø§Ø¶ÙŠ
            createdAt: serverTimestamp()
          });
          count++;
        }
      }
    }
    toast(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${count} Ù…Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø®Ø·Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…`);
  } catch(e) {
    console.error(e);
    toast("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯.", true);
  }
});
  // Add task
  $("btnAddTask")?.addEventListener("click", async ()=>{
    const u = auth.currentUser;
    if(!u) return;

    const title = ($("taskTitle").value||"").trim();
    const course = ($("taskCourse").value||"").trim();
    const dueYMD = ($("taskDue").value||"").trim();
    const minutes = Number(($("taskMin").value||"60"));
    const prio = ($("taskPrio").value||"med");
    const type = ($("taskType").value||"assignment");
    const notes = ($("taskNotes").value||"").trim();

    if(!title){ toast("Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‡Ù…Ø©.", true); return; }

    try{
      await addDoc(tasksCol(u.uid), {
        title, course, dueYMD,
        minutes: Number.isFinite(minutes) ? minutes : 60,
        prio, type, notes,
        done:false,
        createdAt: serverTimestamp(),
        updatedAt: serverTimestamp()
      });

      // clear
      $("taskTitle").value = "";
      $("taskCourse").value = "";
      $("taskNotes").value = "";

      toast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…");
    }catch(e){
      console.error(e);
      toast("ÙØ´Ù„ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‡Ù…Ø©. Ø±Ø§Ø¬Ø¹ Rules.", true);
    }
  });

  function updateTodayPlanMsg(){
    const u = auth.currentUser;
    if(!u) return;
    const msg = $("todayPlanMsg");
    if(!msg) return;

    const today = ymd();
    const over = _tasksCache.filter(t=>{
      const due = parseDue(t.dueYMD);
      return !t.done && due && new Date() > due;
    });

    const todays = _tasksCache
      .filter(t=> !t.done && t.dueYMD === today)
      .sort((a,b)=>(Number(a.minutes||60) - Number(b.minutes||60)));

    if(over.length){
      msg.textContent = `Ø¹Ù†Ø¯Ùƒ ${over.length} Ù…Ù‡Ù…Ø© Ù…ØªØ£Ø®Ø±Ø©. Ø®Ù„Ù‘Øµ ÙˆØ­Ø¯Ø© ØµØºÙŠØ±Ø© Ø£ÙˆÙ„Ø§Ù‹ âœ…`;
      return;
    }
    if(todays.length){
      const t = todays[0];
      msg.textContent = `Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ…: Ø§Ø¨Ø¯Ø£ Ø¨Ù€ "${t.title}" Ù„Ù…Ø¯Ø© ${Number(t.minutes||60)} Ø¯Ù‚ÙŠÙ‚Ø©.`;
      return;
    }
    msg.textContent = "Ø§Ù„ÙŠÙˆÙ… Ø®ÙÙŠÙ âœ… Ø¥Ø°Ø§ Ø¨Ø¯Ùƒ: Ø£Ø¶Ù Ù…Ù‡Ù…Ø© ØµØºÙŠØ±Ø© Ø£Ùˆ Ø±Ø§Ø¬Ø¹ Ù…Ø§Ø¯Ø© 20 Ø¯Ù‚ÙŠÙ‚Ø©.";
  }

  $("btnPlanToday")?.addEventListener("click", ()=>{
    const u = auth.currentUser;
    if(!u) return;
    updateTodayPlanMsg();
    toast("ØªÙ… ØªØ­Ø¯ÙŠØ« Ø®Ø·Ø© Ø§Ù„ÙŠÙˆÙ… âœ…");
  });

  // =========================
  // GPA (grade symbols)
  // =========================
  const GRADE_MAP = {
    "A+": [4.0,4.0], "A":[3.75,4.0], "A-":[3.5,3.75],
    "B+":[3.25,3.5], "B":[3.0,3.25], "B-":[2.75,3.0],
    "C+":[2.5,2.75], "C":[2.25,2.5], "C-":[2.0,2.25],
    "D+":[1.75,2.0], "D":[1.5,1.75], "F":[0,0],

    "Ø£+": [4.0,4.0], "Ø£":[3.75,4.0], "Ø£-":[3.5,3.75],
    "Ø¨+": [3.25,3.5], "Ø¨":[3.0,3.25], "Ø¨-":[2.75,3.0],
    "Ø¬+": [2.5,2.75], "Ø¬":[2.25,2.5], "Ø¬-":[2.0,2.25],
    "Ø¯+": [1.75,2.0], "Ø¯":[1.5,1.75], "Ø±":[0,0]
  };

  // datalist
  const ds = $("gradeSymbols");
  if(ds){
    ds.innerHTML = Object.keys(GRADE_MAP).map(k=> `<option value="${esc(k)}"></option>`).join("");
  }

  let _unsubTaken = null;
  let _takenCache = [];

  function calcGpa(list){
    let creditsSum = 0;
    let minPoints = 0;
    let maxPoints = 0;

    for(const c of list){
      const cr = Number(c.credits||0);
      if(!cr) continue;
      creditsSum += cr;
      minPoints += cr * Number(c.pointsMin||0);
      maxPoints += cr * Number(c.pointsMax||0);
    }
    const gpaMin = creditsSum ? (minPoints/creditsSum) : 0;
    const gpaMax = creditsSum ? (maxPoints/creditsSum) : 0;
    const gpaMid = (gpaMin + gpaMax)/2;
    return { creditsSum, gpaMin, gpaMax, gpaMid };
  }

  function renderTaken(uid, list){
    const wrap = $("takenList");
    if(!wrap) return;
    if(!list.length){
      wrap.innerHTML = `<div class="item"><div class="meta">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯.</div></div>`;
      return;
    }
    wrap.innerHTML = list.map(c=>`
      <div class="item">
        <div class="topRow">
          <div style="font-weight:950">${esc(c.name||"")}</div>
          <div class="meta">${Number(c.credits||0)} Ø³Ø§Ø¹Ø§Øª Â· ${esc(c.grade||"")}</div>
        </div>
        <div class="hr"></div>
        <div class="meta">Points range: ${Number(c.pointsMin||0).toFixed(2)} â€” ${Number(c.pointsMax||0).toFixed(2)}</div>
        <div class="hr"></div>
        <div class="actions">
          <button class="btn smallBtn danger" data-del="${esc(c.id)}">Ø­Ø°Ù</button>
        </div>
      </div>
    `).join("");

    wrap.querySelectorAll("button[data-del]").forEach(b=>{
      b.addEventListener("click", async ()=>{
        if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø©ØŸ")) return;
        try{
          await deleteDoc(doc(db,"users",uid,"taken", b.dataset.del));
          toast("ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…");
        }catch(e){
          console.error(e);
          toast("ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù.", true);
        }
      });
    });
  }

  function updateGpaUI(){
    const { creditsSum, gpaMin, gpaMax, gpaMid } = calcGpa(_takenCache);
    $("crDone").textContent = creditsSum ? String(creditsSum) : "â€”";
    $("coursesCount").textContent = String(_takenCache.length || 0);

    $("minGpaPossible").textContent = creditsSum ? gpaMin.toFixed(2) : "â€”";
    $("maxGpaPossible").textContent = creditsSum ? gpaMax.toFixed(2) : "â€”";
    $("gpaC").textContent = creditsSum ? gpaMid.toFixed(2) : "â€”";
    $("ppc").textContent = creditsSum ? gpaMid.toFixed(2) : "â€”";

    $("gpaMsg").textContent = creditsSum
      ? `Ù…Ø¹Ø¯Ù„Ùƒ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ Ø¶Ù…Ù† Ø±ÙŠÙ†Ø¬: ${gpaMin.toFixed(2)} â€” ${gpaMax.toFixed(2)}`
      : "Ø£Ø¶Ù Ù…ÙˆØ§Ø¯Ùƒ Ø¹Ø´Ø§Ù† ÙŠØ·Ù„Ø¹ Ø§Ù„ØªØ­Ù„ÙŠÙ„.";
  }

  function startTakenListener(uid){
    if(_unsubTaken) _unsubTaken();
    const qy = query(takenCol(uid), orderBy("createdAt","desc"));
    _unsubTaken = onSnapshot(qy, (snap)=>{
      _takenCache = snap.docs.map(d=>({id:d.id, ...d.data()}));
      renderTaken(uid, _takenCache);
      updateGpaUI();
      updateCoachSummary();
    }, (err)=>{
      console.error(err);
      toast("Ù…Ø´ÙƒÙ„Ø© Ù‚Ø±Ø§Ø¡Ø© GPA. Ø±Ø§Ø¬Ø¹ Rules.", true);
    });
  }

  $("btnAddTaken")?.addEventListener("click", async ()=>{
    const u = auth.currentUser;
    if(!u) return;

    const name = ($("takenName").value||"").trim();
    const credits = Number(($("takenCredits").value||"3"));
    const grade = ($("takenGrade").value||"").trim();
    const cat = ($("takenCat").value||"major");

    if(!name){ toast("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©.", true); return; }
    if(!GRADE_MAP[grade]){ toast("Ø§ÙƒØªØ¨ Ø±Ù…Ø² ØµØ­ÙŠØ­ (A+ / Ø£+ ...).", true); return; }

    const [min,max] = GRADE_MAP[grade];

    try{
      await addDoc(takenCol(u.uid), {
        name,
        credits: Number.isFinite(credits) ? credits : 3,
        grade,
        cat,
        pointsMin: min,
        pointsMax: max,
        createdAt: serverTimestamp()
      });

      $("takenName").value="";
      $("takenGrade").value="";
      toast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…");
    }catch(e){
      console.error(e);
      toast("ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©. Ø±Ø§Ø¬Ø¹ Rules.", true);
    }
  });

  // =========================
  // Planner
  // =========================
  let _unsubPlan = null;
  let _planCache = [];

  function renderPlan(uid, list){
    const wrap = $("planList");
    if(!wrap) return;
    if(!list.length){
      wrap.innerHTML = `<div class="item"><div class="meta">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ø¨Ø§Ù„Ø®Ø·Ø©.</div></div>`;
      return;
    }
    wrap.innerHTML = list.map(c=>`
      <div class="item">
        <div class="topRow">
          <div style="font-weight:950">${esc(c.code||"")} â€” ${esc(c.name||"")}</div>
          <div class="meta">${Number(c.credits||0)} Ø³Ø§Ø¹Ø§Øª</div>
        </div>
        <div class="hr"></div>
        <div class="meta">Prereq: ${(c.prereq||[]).map(esc).join(", ") || "â€”"}</div>
        <div class="hr"></div>
        <div class="actions">
          <button class="btn smallBtn danger" data-del="${esc(c.id)}">Ø­Ø°Ù</button>
        </div>
      </div>
    `).join("");

    wrap.querySelectorAll("button[data-del]").forEach(b=>{
      b.addEventListener("click", async ()=>{
        if(!confirm("Ø­Ø°Ù Ø§Ù„Ù…Ø§Ø¯Ø© Ù…Ù† Ø§Ù„Ø®Ø·Ø©ØŸ")) return;
        try{
          await deleteDoc(doc(db,"users",uid,"plan", b.dataset.del));
          toast("ØªÙ… Ø§Ù„Ø­Ø°Ù âœ…");
        }catch(e){
          console.error(e);
          toast("ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù.", true);
        }
      });
    });
  }

  function startPlanListener(uid){
    if(_unsubPlan) _unsubPlan();
    const qy = query(planCol(uid), orderBy("createdAt","desc"));
    _unsubPlan = onSnapshot(qy, (snap)=>{
      _planCache = snap.docs.map(d=>({id:d.id, ...d.data()}));
      renderPlan(uid, _planCache);
      updateCoachSummary();
    }, (err)=>{
      console.error(err);
      toast("Ù…Ø´ÙƒÙ„Ø© Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø®Ø·Ø©. Ø±Ø§Ø¬Ø¹ Rules.", true);
    });
  }

  $("btnAddPlan")?.addEventListener("click", async ()=>{
    const u = auth.currentUser; if(!u) return;
    const code = ($("planCode").value||"").trim().toUpperCase();
    const name = ($("planName").value||"").trim();
    const credits = Number(($("planCredits").value||"3"));
    const cat = ($("planCat").value||"major");
    const prereqRaw = ($("planPrereq").value||"").trim();
    const prereq = prereqRaw ? prereqRaw.split(",").map(x=>x.trim().toUpperCase()).filter(Boolean) : [];

    if(!code || !name){ toast("Ø§ÙƒØªØ¨ ÙƒÙˆØ¯ + Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©.", true); return; }

    try{
      await addDoc(planCol(u.uid), {
        code, name,
        credits: Number.isFinite(credits)?credits:3,
        cat, prereq,
        createdAt: serverTimestamp()
      });
      $("planCode").value=""; $("planName").value=""; $("planPrereq").value="";
      toast("ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…");
    }catch(e){
      console.error(e);
      toast("ÙØ´Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©. Ø±Ø§Ø¬Ø¹ Rules.", true);
    }
  });

  $("btnSuggestCourses")?.addEventListener("click", ()=>{
    const u = auth.currentUser; if(!u) return;
    const wrap = $("suggestList");
    if(!wrap) return;

    // available if prereq all taken
    const takenCodes = new Set(_takenCache.map(x=> String(x.name||"").toUpperCase()));
    const available = _planCache.filter(c=>{
      const pre = c.prereq || [];
      if(!pre.length) return true;
      return pre.every(p=> takenCodes.has(String(p).toUpperCase()));
    });

    if(!available.length){
      wrap.innerHTML = `<div class="item"><div class="meta">Ù…Ø§ ÙÙŠ Ù…ÙˆØ§Ø¯ Ù…ØªØ§Ø­Ø© Ø­Ø³Ø¨ Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª (Ø£Ùˆ Ù…Ø§ Ø£Ø¯Ø®Ù„Øª Ø±Ù…ÙˆØ² Ù…ÙˆØ§Ø¯Ùƒ Ø§Ù„Ù…Ø£Ø®ÙˆØ°Ø© Ø¨Ù†ÙØ³ Ø§Ù„ÙƒÙˆØ¯).</div></div>`;
      return;
    }

    wrap.innerHTML = available.slice(0,20).map(c=>`
      <div class="item">
        <div style="font-weight:950">${esc(c.code||"")} â€” ${esc(c.name||"")}</div>
        <div class="meta">${Number(c.credits||0)} Ø³Ø§Ø¹Ø§Øª Â· Prereq: ${(c.prereq||[]).map(esc).join(", ") || "â€”"}</div>
      </div>
    `).join("");
    toast("ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÙˆØ§Ø¯ Ù…ØªØ§Ø­Ø© âœ…");
  });

  // =========================
  // Coach (Gemini unified)
  // =========================
  async function geminiGenerate(promptText){
    if(!GEMINI_API_KEY || GEMINI_API_KEY.includes("PUT_YOUR")){
      throw new Error("missing_gemini_key");
    }

    const body = { contents: [{ role:"user", parts:[{text: promptText}]}] };
    const res = await fetch(GEMINI_ENDPOINT, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify(body)
    });
    if(!res.ok){
      const t = await res.text().catch(()=> "");
      throw new Error("gemini_http_" + res.status + "_" + t.slice(0,120));
    }
    const json = await res.json();
    const text = json?.candidates?.[0]?.content?.parts?.map(p=>p.text).join("") || "Ù…Ø§ Ø·Ù„Ø¹ Ø±Ø¯.";
    return text.trim();
  }
// ==========================================
// ğŸ¤– Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ (AI Course Advisor)
// ==========================================
// ==========================================
// ğŸ¤– Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ Ø§Ù„Ù…Ø·ÙˆØ± (Smart AI Planner)
// ==========================================
// ğŸ›‘ Ø§Ø³ØªØ¨Ø¯Ù„ ÙƒÙˆØ¯ Ø²Ø± btnSmartSuggest Ø§Ù„Ù‚Ø¯ÙŠÙ… Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ğŸ›‘

$("btnSmartSuggest").onclick = async () => {
    const u = auth.currentUser; if(!u) return;
    const out = $("suggestList");
    out.innerHTML = `<div class="item">â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª...</div>`;

    // 1. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªÙ†Ø¸ÙŠÙ ÙˆÙ…Ù‚Ø§Ø±Ù†Ø©)
    const takenCodes = _takenCache.map(c => (c.name||"").split(" ")[0].trim().toUpperCase());
    const takenNames = _takenCache.map(c => (c.name||"").trim().toLowerCase());

    const labPref = $("labPref").value; // yes, no, focus
    const targetHours = $("targetHours").value; // 12-15 etc

    // 2. ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ù…Ù† Ø§Ù„Ø®Ø·Ø© (Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ© ÙÙ‚Ø·)
    const available = _planCache.filter(p => {
        // Ù‡Ù„ Ø§Ù„Ù…Ø§Ø¯Ø© Ù…Ø£Ø®ÙˆØ°Ø© Ø³Ø§Ø¨Ù‚Ø§Ù‹ØŸ (Ø´ÙŠÙƒ Ø¹ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ¹ Ø§Ù„Ø§Ø³Ù…)
        const code = (p.code||"").trim().toUpperCase();
        const name = (p.name||"").trim().toLowerCase();
        if(takenCodes.some(tc=>tc===code || (code && tc.includes(code)))) return false;
        if(takenNames.includes(name)) return false;

        // ğŸ›‘ ÙÙ„ØªØ± Ø§Ù„Ù„Ø§Ø¨Ø§Øª: Ø¥Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ø®ØªØ§Ø± "no"ØŒ Ø§Ø³ØªØ«Ù†ÙŠ Ø£ÙŠ Ù…Ø§Ø¯Ø© Ù†ÙˆØ¹Ù‡Ø§ lab Ø£Ùˆ Ø³Ø§Ø¹Ø§ØªÙ‡Ø§ 1
        if(labPref === "no" && (p.type === "lab" || p.credits === 1)) return false; 
        
        return true;
    });

    if(available.length === 0){
        out.innerHTML = `<div class="item ok">ğŸ‰ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¯ Ù…ØªØ¨Ù‚ÙŠØ© (Ø£Ùˆ Ø§Ù„ÙÙ„ØªØ± Ø£Ø®ÙÙ‰ ÙƒÙ„ Ø´ÙŠØ¡).</div>`;
        return;
    }

    // 3. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù„Ù€ Gemini (Prompt)
    const prompt = `
    Ø¨ØµÙØªÙƒ Ù…Ø±Ø´Ø¯Ø§Ù‹ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ§Ù‹ Ø®Ø¨ÙŠØ±Ø§Ù‹.
    Ø§Ù„Ø·Ø§Ù„Ø¨ ÙŠØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ù„Ù„ÙØµÙ„ Ø§Ù„Ù‚Ø§Ø¯Ù….
    - Ø§Ù„Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©: ${targetHours}
    - ØªÙØ¶ÙŠÙ„ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª: ${labPref === 'no' ? 'Ù„Ø§ ÙŠØ±ÙŠØ¯ Ù…Ø®ØªØ¨Ø±Ø§Øª Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹' : 'ÙŠØ±ØºØ¨ Ø¨ØªÙ†Ø²ÙŠÙ„ Ù…Ø®ØªØ¨Ø±Ø§Øª'}
    - Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„ØªÙŠ Ø£Ù†Ù‡Ø§Ù‡Ø§ (Completed): [${takenCodes.join(", ")}]

    Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Ø®Ø·ØªÙ‡ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© (Available Courses):
    ${available.map(c => `- [${c.code}] ${c.name} (${c.credits}Ø³, Ù†ÙˆØ¹:${c.type||'major'}) | Ø§Ù„Ù…ØªØ·Ù„Ø¨ Ø§Ù„Ø³Ø§Ø¨Ù‚: ${c.prereq}`).join("\n")}

    Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù†Ùƒ:
    1. Ø§Ù‚ØªØ±Ø­ Ø¬Ø¯ÙˆÙ„Ø§Ù‹ Ø¯Ø±Ø§Ø³ÙŠØ§Ù‹ ÙŠØ­Ù‚Ù‚ Ø¹Ø¯Ø¯ Ø§Ù„Ø³Ø§Ø¹Ø§Øª (${targetHours}).
    2. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª: Ù„Ø§ ØªÙ‚ØªØ±Ø­ Ù…Ø§Ø¯Ø© Ø¥Ù„Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø·Ø§Ù„Ø¨ Ù‚Ø¯ Ø£Ù†Ù‡Ù‰ Ù…ØªØ·Ù„Ø¨Ù‡Ø§ Ø§Ù„Ù…Ø°ÙƒÙˆØ±.
    3. Ø±ØªØ¨ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø­Ø³Ø¨ Ø§Ù„Ø£Ù‡Ù…ÙŠØ© (Ù…ÙˆØ§Ø¯ Ø§Ù„ØªØ®ØµØµ Ø£ÙˆÙ„Ø§Ù‹).
    4. Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸Ø© ØµØºÙŠØ±Ø© Ø¨Ø¬Ø§Ù†Ø¨ ÙƒÙ„ Ù…Ø§Ø¯Ø© (Ù„Ù…Ø§Ø°Ø§ Ø§Ø®ØªØ±ØªÙ‡Ø§ØŸ).
    
    Ø§Ù„Ø±Ø¯ Ø¨ØªÙ†Ø³ÙŠÙ‚ HTML (Ù‚Ø§Ø¦Ù…Ø© <ul>).
    `;

    // 4. Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    try{
        const aiRes = await geminiGenerate(prompt); // ØªØ£ÙƒØ¯ Ø£Ù† Ø¯Ø§Ù„Ø© geminiGenerate Ù…Ø¹Ø±ÙØ© Ø¹Ù†Ø¯Ùƒ
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø¯ Ù…Ù† ÙƒÙˆØ¯ Ù…Ø§Ø±ÙƒØ¯Ø§ÙˆÙ†
        const cleanHtml = aiRes.replace(/```html/g,'').replace(/```/g,''); 
        out.innerHTML = `<div class="item" style="background:#f0f9ff; border:1px solid #bae6fd;">${cleanHtml}</div>`;
    } catch(e){
        console.error(e);
        out.innerHTML = `<div class="item danger">Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù…Ø³ØªØ´Ø§Ø± Ø§Ù„Ø°ÙƒÙŠ.</div>`;
    }
};
$("btnCoachAsk")?.addEventListener("click", async ()=>{
    const u = auth.currentUser; if(!u) return;

    const focus = $("coachFocus")?.value || "weak";
    const style = $("coachStyle")?.value || "steps";
    const length = $("coachLength")?.value || "short"; // Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
    const userText = ($("coachInput")?.value || "").trim();

    const out = $("coachAnswer");
    if(out) out.textContent = "â€¦ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±";

    // ğŸ’¡ ØªØ¬Ù‡ÙŠØ² ØªØ¹Ù„ÙŠÙ…Ø§Øª Ø§Ù„Ø·ÙˆÙ„
    let lengthInstruction = "";
    if(length === "short") {
      lengthInstruction = "Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹: Ø§Ù„Ø±Ø¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù‚ØµÙŠØ±Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ (Ø£Ù‚Ù„ Ù…Ù† 60 ÙƒÙ„Ù…Ø©). Ø§Ø¹Ø·Ù Ø§Ù„Ø²Ø¨Ø¯Ø© ÙÙŠ 3 Ù†Ù‚Ø§Ø· ÙÙ‚Ø· Ø¨Ø¯ÙˆÙ† Ù…Ù‚Ø¯Ù…Ø§Øª ÙˆÙ„Ø§ Ø®ØªØ§Ù….";
    } else {
      lengthInstruction = "Ø§Ù„Ø±Ø¯ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù…ÙØµÙ„Ø§Ù‹. Ø§Ø´Ø±Ø­ Ø§Ù„Ø®Ø·ÙˆØ§ØªØŒ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ØŒ ÙˆÙƒÙŠÙÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¹Ù…Ù‚.";
    }

    const prompt = `
Ø£Ù†Øª Ù…Ø±Ø´Ø¯ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ (Mentor).
Ø§Ù„Ø·Ø§Ù„Ø¨ ÙŠØ´ØªÙƒÙŠ Ù…Ù†: "${userText || "ØªÙˆØ¬ÙŠÙ‡ Ø¹Ø§Ù…"}"
Ø§Ù„ØªØ±ÙƒÙŠØ²: ${focus} | Ø§Ù„Ø£Ø³Ù„ÙˆØ¨: ${style}

${lengthInstruction}

ØªÙƒÙ„Ù… Ø¨Ù„Ù‡Ø¬Ø© Ø·Ù„Ø§Ø¨ÙŠØ© Ù…ÙÙ‡ÙˆÙ…Ø©.
`;

    try{
      const ans = await geminiGenerate(prompt);
      out.textContent = ans;
      toast("ØªÙ… âœ…");
    }catch(e){
      console.error(e);
      out.textContent = "Error communicating with Coach.";
      toast("Ø®Ø·Ø£", true);
    }
  });

  $("btnCoachQuick")?.addEventListener("click", ()=>{
    const u = auth.currentUser; if(!u) return;
    const out = $("coachAnswer");
    const today = ymd();
    const over = _tasksCache.filter(t=>{
      const due = parseDue(t.dueYMD);
      return !t.done && due && new Date() > due;
    });
    const todays = _tasksCache.filter(t=> !t.done && t.dueYMD === today);

    if(over.length){
      out.textContent = `Ø¹Ù†Ø¯Ùƒ ${over.length} Ù…Ù‡Ù…Ø© Ù…ØªØ£Ø®Ø±Ø©. Ø§Ø®ØªØ§Ø± ÙˆØ­Ø¯Ø© Ø£Ù‚Ù„ ÙˆÙ‚Øª ÙˆØ§Ø¨Ø¯Ø£ 25 Ø¯Ù‚ÙŠÙ‚Ø© Ø§Ù„Ø¢Ù†.`;
    }else if(todays.length){
      const t = todays.sort((a,b)=>Number(a.minutes||60)-Number(b.minutes||60))[0];
      out.textContent = `Ø§Ø¨Ø¯Ø£ Ø§Ù„ÙŠÙˆÙ… Ø¨Ù€ "${t.title}" Ù„Ù…Ø¯Ø© ${Number(t.minutes||60)} Ø¯Ù‚ÙŠÙ‚Ø©. Ø¨Ø¹Ø¯ÙŠÙ† 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø±Ø§Ø­Ø©.`;
    }else{
      out.textContent = "Ø§Ù„ÙŠÙˆÙ… ÙØ§Ø¶ÙŠØŸ Ø§Ø¹Ù…Ù„ 20 Ø¯Ù‚ÙŠÙ‚Ø© Ù…Ø±Ø§Ø¬Ø¹Ø© Ù„Ù…Ø§Ø¯Ø© Ø¶Ø¹ÙŠÙØ© + 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ù…Ù„Ø®Øµ.";
    }
    toast("Ø§Ù‚ØªØ±Ø§Ø­ Ø¬Ø§Ù‡Ø² âœ…");
  });

  function updateCoachSummary(){
    const wrap = $("coachSummary");
    if(!wrap) return;

    const weak = _takenCache.length
      ? [..._takenCache].sort((a,b)=> Number(a.pointsMax||0)-Number(b.pointsMax||0))[0]
      : null;

    const next = _tasksCache
      .filter(t=> !t.done && t.dueYMD)
      .sort((a,b)=> (a.dueYMD||"9999-12-31").localeCompare(b.dueYMD||"9999-12-31"))[0];

    wrap.innerHTML = `
      <div class="item">
        <div style="font-weight:950">Ø£Ø¶Ø¹Ù Ù…Ø§Ø¯Ø©</div>
        <div class="meta">${weak ? `${esc(weak.name)} (${esc(weak.grade)})` : "â€”"}</div>
      </div>
      <div class="item">
        <div style="font-weight:950">Ø£Ù‚Ø±Ø¨ Ù…Ù‡Ù…Ø©</div>
        <div class="meta">${next ? `${esc(next.title)} Â· ${esc(next.dueYMD||"")}` : "â€”"}</div>
      </div>
      <div class="item">
        <div style="font-weight:950">Ù†ØµÙŠØ­Ø© Ø³Ø±ÙŠØ¹Ø©</div>
        <div class="meta">Ø§Ø¨Ø¯Ø£ Ø¨Ù€ 25 Ø¯Ù‚ÙŠÙ‚Ø© ØªØ±ÙƒÙŠØ² + 5 Ø±Ø§Ø­Ø©. Ø£Ù‡Ù… Ø´ÙŠØ¡ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©.</div>
      </div>
    `;
  }

  // =========================
  // Profile settings
  // =========================
  async function loadProfile(uid){
    const snap = await getDoc(userDoc(uid));
    if(!snap.exists()) return;
    const data = snap.data();
    const p = data.profile || {};
    $("pName").value = p.name || "";
    $("pPhone").value = p.phone || "";
    $("pMajor").value = p.major || "";
    $("pYear").value = p.year || "";
    $("pTerm").value = p.term || "";
    $("pDob").value = p.dob || "";
    $("emailVerified").textContent = data.emailVerified ? "Yes" : "No";
  }

$("btnSaveProfile")?.addEventListener("click", async ()=>{
    const u = auth.currentUser; if(!u) return;

    // Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ù‚ÙˆØ§Ø¦Ù…
    const secVal = $("sectorSelect").value;
    const uniVal = $("universitySelect").value;
    const colVal = $("collegeSelect").value;
    const majVal = $("majorSelect").value;
    const degVal = $("degreeLevelSelect").value; // Ø§Ù„Ø¯Ø±Ø¬Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©

    // Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù„Ù„Ø­ÙØ¸
    let uniName = "";
    let colName = "";
    
    if(window.JORDAN_ACADEMIC_DATA && uniVal){
        const uData = window.JORDAN_ACADEMIC_DATA[uniVal];
        uniName = uData.name;
        if(colVal && uData.colleges[colVal]){
            colName = uData.colleges[colVal].name;
        }
    }

    const profile = {
      name: ($("pName").value||"").trim(),
      phone: ($("pPhone").value||"").trim(),
      
      // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      sector: secVal,       // gov/pvt
      degree: degVal,       // bachelor/diploma...
      university: uniName,
      college: colName,
      major: majVal || ($("pMajor").value||"").trim(),

      year: ($("pYear").value||"").trim(),
      term: ($("pTerm").value||"").trim(),
      dob: ($("pDob").value||"").trim()
    };

    try{
      await setDoc(userDoc(u.uid), { profile, lastSeen: nowISO() }, { merge:true });
      toast("ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…");
      $("profileMsg").textContent = "ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙÙƒ Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ âœ…";
    }catch(e){
      console.error(e);
      toast("ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸.", true);
    }
  });

  $("btnSendVerify")?.addEventListener("click", async ()=>{
    const u = auth.currentUser; if(!u) return;
    try{
      await sendEmailVerification(u);
      toast("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ âœ…");
    }catch(e){
      console.error(e);
      toast("ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ù‚Ù‚.", true);
    }
  });

  // =========================
  // ADMIN (read users list)
  // =========================
  let _unsubAdminUsers = null;
  let _adminUsersCache = [];
  let _selectedUserId = "";

  function isAdminUser(){
    const u = auth.currentUser;
    return !!u && (u.email||"").toLowerCase() === MAIN_ADMIN_EMAIL.toLowerCase();
  }

  function renderAdminUsers(){
    const body = $("aTableBody");
    if(!body) return;

    const q = ($("aQ").value||"").trim().toLowerCase();
    const year = ($("aYear").value||"").trim();
    const sort = ($("aSort").value||"lastSeen_desc");

    let list = [..._adminUsersCache];

    if(q){
      list = list.filter(u=>{
        const n = (u.profile?.name||u.displayName||"").toLowerCase();
        const e = (u.email||"").toLowerCase();
        const m = (u.profile?.major||"").toLowerCase();
        return n.includes(q) || e.includes(q) || m.includes(q);
      });
    }
    if(year){
      list = list.filter(u=> String(u.profile?.year||"") === year);
    }

    if(sort === "created_desc"){
      list.sort((a,b)=>(b.createdAt?.seconds||0)-(a.createdAt?.seconds||0));
    }else{
      // lastSeen desc
      list.sort((a,b)=> String(b.lastSeen||"").localeCompare(String(a.lastSeen||"")));
    }

    body.innerHTML = list.slice(0,200).map(u=>`
      <tr class="clickRow" data-id="${esc(u.id)}">
        <td>${esc(u.profile?.name || u.displayName || "â€”")}</td>
        <td>${esc(u.email || "â€”")}</td>
        <td>${esc(u.profile?.major || "â€”")}</td>
        <td>${esc(u.profile?.year || "â€”")}</td>
        <td>${esc(u.lastSeen ? u.lastSeen.slice(0,19).replace("T"," ") : "â€”")}</td>
      </tr>
    `).join("");

    body.querySelectorAll("tr[data-id]").forEach(r=>{
      r.addEventListener("click", ()=> selectAdminUser(r.dataset.id));
    });

    $("aUsers").textContent = String(_adminUsersCache.length || 0);

    // active 7 days approx
    const cutoff = new Date(); cutoff.setDate(cutoff.getDate()-7);
    const active = _adminUsersCache.filter(u=>{
      const ls = u.lastSeen ? new Date(u.lastSeen) : null;
      return ls && ls >= cutoff;
    }).length;
    $("aActive").textContent = String(active);

    // avg gpa approx from stored field if exists (we wonâ€™t store it now)
    $("aAvgGpa").textContent = "â€”";
  }

  async function selectAdminUser(uid){
    _selectedUserId = uid;
    $("aSel").textContent = uid ? uid.slice(0,10)+"â€¦" : "â€”";

    const wrap = $("aDetails");
    if(!wrap) return;

    try{
      const snap = await getDoc(doc(db,"users",uid));
      if(!snap.exists()){
        wrap.innerHTML = `<div class="item"><div class="meta">User not found.</div></div>`;
        return;
      }
      const u = snap.data();
      wrap.innerHTML = `
        <div class="item">
          <div style="font-weight:950">Profile</div>
          <div class="meta">
            Ø§Ù„Ø§Ø³Ù…: ${esc(u.profile?.name||u.displayName||"â€”")}<br>
            Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„: ${esc(u.email||"â€”")}<br>
            Ø§Ù„ØªØ®ØµØµ: ${esc(u.profile?.major||"â€”")}<br>
            Ø§Ù„Ø³Ù†Ø©: ${esc(u.profile?.year||"â€”")}<br>
            Ø¢Ø®Ø± Ù†Ø´Ø§Ø·: ${esc(u.lastSeen||"â€”")}
          </div>
        </div>
      `;

      // read last tasks (read-only)
      const tSnap = await getDocs(query(collection(db,"users",uid,"tasks"), orderBy("createdAt","desc"), limit(5)));
      const tasks = tSnap.docs.map(d=>({id:d.id, ...d.data()}));

      wrap.innerHTML += `
        <div class="item">
          <div style="font-weight:950">Ø¢Ø®Ø± 5 Ù…Ù‡Ø§Ù…</div>
          <div class="meta">${tasks.length ? tasks.map(t=>`â€¢ ${esc(t.title)} ${t.dueYMD?`(${esc(t.dueYMD)})`:""} ${t.done?"âœ…":""}`).join("<br>") : "â€”"}</div>
        </div>
      `;

      const gSnap = await getDocs(query(collection(db,"users",uid,"taken"), orderBy("createdAt","desc"), limit(5)));
      const taken = gSnap.docs.map(d=>({id:d.id, ...d.data()}));
      wrap.innerHTML += `
        <div class="item">
          <div style="font-weight:950">Ø¢Ø®Ø± 5 Ù…ÙˆØ§Ø¯ (GPA)</div>
          <div class="meta">${taken.length ? taken.map(c=>`â€¢ ${esc(c.name)} (${esc(c.grade||"")})`).join("<br>") : "â€”"}</div>
        </div>
      `;
    }catch(e){
      console.error(e);
      wrap.innerHTML = `<div class="item"><div class="meta">Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø±Ø§Ø¡Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨. Ø±Ø§Ø¬Ø¹ Rules.</div></div>`;
    }
  }

  function startAdminUsersListener(){
    if(_unsubAdminUsers) _unsubAdminUsers();
    // users list
    const qy = query(collection(db,"users"), orderBy("lastSeen","desc"), limit(300));
    _unsubAdminUsers = onSnapshot(qy, (snap)=>{
      _adminUsersCache = snap.docs.map(d=>({id:d.id, ...d.data()}));
      renderAdminUsers();

      // recent list
      const recent = $("aRecent");
      if(recent){
        recent.innerHTML = _adminUsersCache.slice(0,12).map(u=>`
          <div class="item">
            <div style="font-weight:950">${esc(u.profile?.name || u.displayName || "â€”")}</div>
            <div class="meta">${esc(u.email||"â€”")}<br>LastSeen: ${esc(u.lastSeen||"â€”")}</div>
          </div>
        `).join("");
      }
      $("adminHomeMsg").textContent = "Ø¬Ø§Ù‡Ø² âœ…";
    }, (err)=>{
      console.error(err);
      $("adminHomeMsg").textContent = "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø±Ø§Ø¡Ø© users. Ø§ÙØ­Øµ Rules.";
      toast("Admin read failed. Check Rules.", true);
    });
  }

  $("btnAdminRefresh")?.addEventListener("click", ()=>{
    if(!isAdminUser()) return;
    renderAdminUsers();
    toast("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« âœ…");
  });
  $("aQ")?.addEventListener("input", ()=> renderAdminUsers());
  $("aYear")?.addEventListener("change", ()=> renderAdminUsers());
  $("aSort")?.addEventListener("change", ()=> renderAdminUsers());

  // =========================
  // Auth State
  // =========================
  onAuthStateChanged(auth, async (user)=>{
    // cleanup
    if(_unsubTasks) { _unsubTasks(); _unsubTasks = null; }
    if(_unsubTaken) { _unsubTaken(); _unsubTaken = null; }
    if(_unsubPlan)  { _unsubPlan();  _unsubPlan  = null; }
    if(_unsubAdminUsers){ _unsubAdminUsers(); _unsubAdminUsers=null; }

    _tasksCache = [];
    _takenCache = [];
    _planCache  = [];
    $("taskList").innerHTML = `<div class="item"><div class="meta">Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø¹Ø´Ø§Ù† ØªØ¸Ù‡Ø± Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.</div></div>`;
    $("takenList").innerHTML = `<div class="item"><div class="meta">Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø¹Ø´Ø§Ù† ØªØ¸Ù‡Ø± Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.</div></div>`;
    $("planList").innerHTML = `<div class="item"><div class="meta">Ø³Ø¬Ù‘Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ø¹Ø´Ø§Ù† ØªØ¸Ù‡Ø± Ø¨ÙŠØ§Ù†Ø§ØªÙƒ.</div></div>`;
    $("coachSummary").innerHTML = "";
    $("coachAnswer").textContent = " âœ…";
    $("todayPlanMsg").textContent ="";

    if(!user){
      resetGuestUI();
      return;
    }

    authBack.classList.add("hidden");

    const email = (user.email || "").toLowerCase();
    const isAdmin = email === MAIN_ADMIN_EMAIL.toLowerCase();

    if(userLabel){
      userLabel.textContent = (user.email || "â€”") + (user.displayName ? ` (${user.displayName})` : "");
    }
    if(roleLabel){
      roleLabel.textContent = isAdmin ? "Admin" : "Ø·Ø§Ù„Ø¨";
    }

    // ensure root
    try{ await ensureUserRoot(user); }catch(e){ console.warn(e); }

    // enable
    btnOpenSettings && (btnOpenSettings.disabled = false);
    btnBackup && (btnBackup.disabled = false);
    btnRestore && (btnRestore.disabled = false);
    btnLogout && (btnLogout.disabled = false);

    // enable feature buttons
    ["btnAddTask","btnPlanToday","fToday","fWeek","fAll","fOver","btnAddTaken","btnAddPlan","btnSuggestCourses","btnCoachAsk","btnCoachQuick","btnSaveProfile","btnSendVerify","btnAdminRefresh"]
      .forEach(id=>{ const el = $(id); if(el) el.disabled = false; });

    // show correct app
    if(isAdmin){
      adminApp?.classList.remove("hidden");
      adminTabs?.classList.remove("hidden");
      studentApp?.classList.add("hidden");
      studentTabs?.classList.add("hidden");
      showAdminView("admin_home");
      startAdminUsersListener();
    }else{
      studentApp?.classList.remove("hidden");
      studentTabs?.classList.remove("hidden");
      adminApp?.classList.add("hidden");
      adminTabs?.classList.add("hidden");
      showStudentView("tasks");
    }

    // listeners for everyone (admin sees his own too if he uses student view? but we keep admin views only)
    startTasksListener(user.uid);
    startTakenListener(user.uid);
    startPlanListener(user.uid);
    loadProfile(user.uid);

    toast("Ø¬Ø§Ù‡Ø² âœ…");
  });

  toast("âœ… UniPilot Ø¬Ø§Ù‡Ø²");
// ==========================================
// ğŸ“š Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø·Ø· Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠØ© (The Syllabus DB)
// ==========================================
// Ø§Ù„Ù…ÙØªØ§Ø­ Ù‡Ù†Ø§ ÙŠØªÙ… ØªØ±ÙƒÙŠØ¨Ù‡ Ù…Ù†: University_College_Major (Ø§Ù„ØªÙŠ Ø§Ø®ØªØ±Ù†Ø§Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª)
// Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‚Ù…Øª Ø¨ØªØ¹Ø¨Ø¦Ø© Ø®Ø·Ø© "Ø¢Ù„ Ø§Ù„Ø¨ÙŠØª - Ø¹Ù„Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" ÙƒÙ…Ø«Ø§Ù„ Ø­Ù‚ÙŠÙ‚ÙŠ ØªÙ‚Ø±ÙŠØ¨ÙŠ.

const OFFICIAL_PLANS = {

  // Ù…Ø«Ø§Ù„: Ø¬Ø§Ù…Ø¹Ø© Ø¢Ù„ Ø§Ù„Ø¨ÙŠØª -> ÙƒÙ„ÙŠØ© IT -> Ø¹Ù„Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

  "AABU_IT_Data Science and Artificial Intelligence": {
    "Year 1": {
      "Semester 1": [
        { code: "CS111", name: "Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ Ø¹Ù„Ù… Ø§Ù„Ø­Ø§Ø³ÙˆØ¨", credits: 3, prereq: [] },
        { code: "MATH101", name: "ØªÙØ§Ø¶Ù„ ÙˆØªÙƒØ§Ù…Ù„ 1", credits: 3, prereq: [] },
        { code: "ENG101", name: "Ù„ØºØ© Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© 1", credits: 3, prereq: [] },
        { code: "ARB101", name: "Ù„ØºØ© Ø¹Ø±Ø¨ÙŠØ© 1", credits: 3, prereq: [] },
        { code: "MS100", name: "Ø§Ù„Ø¹Ù„ÙˆÙ… Ø§Ù„Ø¹Ø³ÙƒØ±ÙŠØ©", credits: 3, prereq: [] }
      ],
      "Semester 2": [
        { code: "CS112", name: "Object Oriented", credits: 3, prereq: ["CS111"], type: "major" },
        { code: "MATH102", name: "ØªÙØ§Ø¶Ù„ ÙˆØªÙƒØ§Ù…Ù„ 2", credits: 3, prereq: ["MATH101"] },
        { code: "PHYS101", name: "ÙÙŠØ²ÙŠØ§Ø¡ Ø¹Ø§Ù…Ø© 1", credits: 3, prereq: [] },
        { code: "CS181", name: "ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø§Ù„ÙˆÙŠØ¨", credits: 3, prereq: ["CS111"] }
      ]
    },
    "Year 2": {
      "Semester 1": [
        { code: "CS211", name: "ØªØ±Ø§ÙƒÙŠØ¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", credits: 3, prereq: ["CS112", "MATH241"] },
        { code: "DS201", name: "Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ Ø¹Ù„Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", credits: 3, prereq: ["CS112"] },
        { code: "MATH241", name: "Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù…Ù†ÙØµÙ„Ø©", credits: 3, prereq: [] },
        { code: "STAT101", name: "Ø§Ø­ØµØ§Ø¡ ÙˆØ§Ø­ØªÙ…Ø§Ù„Ø§Øª", credits: 3, prereq: [] }
      ],
      "Semester 2": [
        { code: "CS221", name: "Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª", credits: 3, prereq: ["CS211"] },
        { code: "AI201", name: "Ù…Ù‚Ø¯Ù…Ø© ÙÙŠ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", credits: 3, prereq: ["CS112"] },
        { code: "DS210", name: "ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª", credits: 3, prereq: ["DS201", "STAT101"] }
      ]
    },
    "Year 3": {
       // ... ØªÙƒÙ…Ù„Ø© Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø³Ù†ÙˆØ§Øª Ø¨Ù†ÙØ³ Ø§Ù„Ù†Ù…Ø·
       "Semester 1": [
         { code: "AI301", name: "ØªØ¹Ù„Ù… Ø§Ù„Ø¢Ù„Ø© (Machine Learning)", credits: 3, prereq: ["AI201", "STAT101"] },
         { code: "DS320", name: "Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¶Ø®Ù…Ø© (Big Data)", credits: 3, prereq: ["DS210"] }
       ]
    }
  }
  // ÙŠÙ…ÙƒÙ†Ùƒ Ù‡Ù†Ø§ Ø¥Ø¶Ø§ÙØ© Ø®Ø·Ø© Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø£Ø±Ø¯Ù†ÙŠØ©ØŒ Ø§Ù„ØªÙƒÙ†ÙˆØŒ Ø¥Ù„Ø®...

  
};
</script>
<script>
// ==========================================================
// 1. JORDAN ACADEMIC DATA (English Values for Stability)
// ==========================================================
// Ø¬Ø¹Ù„Ù†Ø§Ù‡Ø§ window Ù„ØªÙƒÙˆÙ† Ø¹Ø§Ù…Ø© ÙˆØ´Ø§Ù…Ù„Ø©
window.JORDAN_ACADEMIC_DATA = {
  // ==========================================
  // ğŸ›ï¸ GOVERNMENT UNIVERSITIES (Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©)
  // ==========================================
  "JU": {
    type: "gov",
    name: "University of Jordan (JU)",
    colleges: {
      "IT": { name: "King Abdullah II School of IT", majors: ["Computer Science", "Computer Information Systems (CIS)", "Business Information Technology (BIT)", "Artificial Intelligence", "Data Science"] },
      "Eng": { name: "School of Engineering", majors: ["Civil Engineering", "Architecture", "Electrical Engineering", "Mechanical Engineering", "Chemical Engineering", "Industrial Engineering", "Computer Engineering", "Mechatronics Engineering"] },
      "Med": { name: "Health Schools", majors: ["Medicine", "Dentistry", "Pharmacy", "Doctor of Pharmacy", "Nursing", "Rehabilitation Sciences"] },
      "Sci": { name: "School of Science", majors: ["Mathematics", "Physics", "Chemistry", "Biological Sciences", "Geology", "Medical Analysis"] },
      "Bus": { name: "School of Business", majors: ["Business Administration", "Accounting", "Finance", "Marketing", "MIS", "Public Administration", "Economics"] },
      "Art": { name: "School of Arts & Languages", majors: ["Arabic Language", "English Language", "French", "History", "Geography", "Philosophy", "Sociology", "Psychology"] },
      "Law": { name: "School of Law", majors: ["Law"] },
      "Sha": { name: "School of Sharia", majors: ["Foundations of Religion", "Islamic Jurisprudence"] },
      "Agr": { name: "School of Agriculture", majors: ["Plant Production", "Animal Production", "Nutrition and Food Tech", "Land and Water"] }
    }
  },
  "JUST": {
    type: "gov",
    name: "Jordan Univ of Science & Tech (JUST)",
    colleges: {
      "IT": { name: "Computer & Info Technology", majors: ["Computer Engineering", "Computer Science", "Software Engineering", "Network Engineering", "Artificial Intelligence", "Cybersecurity"] },
      "Eng": { name: "Engineering", majors: ["Civil Engineering", "Electrical Engineering", "Mechanical Engineering", "Chemical Engineering", "Biomedical Engineering", "Industrial Engineering", "Aeronautical Engineering", "Nuclear Engineering"] },
      "Med": { name: "Medical Faculties", majors: ["Medicine", "Dentistry", "Pharmacy", "Doctor of Pharmacy", "Nursing", "Health Management"] },
      "App": { name: "Applied Medical Sciences", majors: ["Medical Lab Sciences", "Radiologic Technology", "Paramedic", "Physical Therapy", "Occupational Therapy", "Optometry"] },
      "Sci": { name: "Science & Arts", majors: ["Mathematics", "Physics", "Chemistry", "Biotechnology", "English Linguistics"] },
      "Agr": { name: "Agriculture", majors: ["Plant Production", "Animal Production", "Nutrition"] },
      "Arc": { name: "Architecture & Design", majors: ["Architecture", "Urban Planning", "Design"] }
    }
  },
  "AABU": {
    type: "gov",
    name: "Al al-Bayt University (AABU)",
    colleges: {
      "IT": { name: "Prince Hussein Bin Abdullah IT", majors: ["Data Science and AI", "Computer Science (CS)", "CIS", "Information Security (Cybersecurity)", "Software Engineering"] },
      "Eng": { name: "Engineering", majors: ["Civil Engineering", "Architecture", "Surveying Engineering", "Renewable Energy Engineering"] },
      "Sci": { name: "Science", majors: ["Mathematics", "Physics", "Chemistry", "Biological Sciences", "Medical Lab Sciences"] },
      "Bus": { name: "Finance & Business", majors: ["Business Administration", "Accounting", "Finance & Banking", "Marketing", "MIS", "Economics"] },
      "Law": { name: "Law", majors: ["Law"] },
      "Sha": { name: "Sharia", majors: ["Jurisprudence (Fiqh)", "Foundations of Religion"] },
      "Nur": { name: "Nursing", majors: ["Nursing"] },
      "Art": { name: "Arts & Humanities", majors: ["Arabic Language", "English Language", "History", "Geography", "Modern Languages"] },
      "Edu": { name: "Educational Sciences", majors: ["Class Teacher", "Special Education", "Child Education"] }
    }
  },
  "HU": {
    type: "gov",
    name: "Hashemite University (HU)",
    colleges: {
      "IT": { name: "Prince Hussein Bin Abdullah IT", majors: ["Computer Science", "Software Engineering", "CIS", "Business Information Technology", "Data Science and AI"] },
      "Eng": { name: "Engineering", majors: ["Civil Engineering", "Electrical Engineering", "Mechanical Engineering", "Industrial Engineering", "Mechatronics Engineering", "Biomedical Engineering", "Architecture"] },
      "Med": { name: "Health Sciences", majors: ["Medicine", "Pharmacy", "Medical Lab Sciences", "Clinical Nutrition", "Nursing", "Physical Therapy"] },
      "Bus": { name: "Business", majors: ["Accounting", "Business Administration", "Banking & Finance", "Risk Management", "MIS", "Economics", "Digital Marketing"] },
      "Art": { name: "Arts", majors: ["Arabic", "English", "Literature", "International Relations"] },
      "Chi": { name: "Queen Rania for Childhood", majors: ["Early Childhood", "Special Education"] }
    }
  },
  "YU": {
    type: "gov",
    name: "Yarmouk University (YU)",
    colleges: {
      "IT": { name: "IT & Computer Science", majors: ["Computer Science", "CIS", "Business Information Technology", "Cybersecurity", "Data Science"] },
      "Eng": { name: "Hijjawi Faculty for Engineering", majors: ["Electronics Engineering", "Telecommunications Engineering", "Electrical Power Engineering", "Computer Engineering", "Biomedical Systems", "Civil Engineering", "Industrial Engineering", "Architecture"] },
      "Sci": { name: "Science", majors: ["Mathematics", "Physics", "Chemistry", "Biological Sciences", "Statistics", "Earth & Environmental Sciences"] },
      "Med": { name: "Medicine & Pharmacy", majors: ["Medicine", "Pharmacy"] },
      "Bus": { name: "Economics & Admin", majors: ["Economics", "Accounting", "Business Administration", "Finance", "Marketing", "Public Administration"] },
      "Art": { name: "Arts", majors: ["Arabic", "English", "Modern Languages", "History", "Geography", "Sociology", "Political Science"] },
      "Fin": { name: "Fine Arts", majors: ["Design", "Plastic Arts", "Music", "Drama"] },
      "Law": { name: "Law", majors: ["Law"] },
      "Mas": { name: "Mass Communication", majors: ["Journalism", "Radio & TV", "Public Relations"] }
    }
  },
  "BAU": {
    type: "gov",
    name: "Balqa Applied University (BAU - Center & Colleges)",
    colleges: {
      "Eng": { name: "Engineering (Salt)", majors: ["Civil Engineering", "Architecture", "Surveying", "Materials Engineering", "Computer Engineering"] },
      "Sci": { name: "Science (Salt)", majors: ["Mathematics", "Physics", "Chemistry", "Medical Analysis", "Biotechnology"] },
      "AI":  { name: "Prince Abdullah Bin Ghazi IT (Salt)", majors: ["Computer Science", "Software Engineering", "Cybersecurity", "Virtual Reality (VR)", "Data Science", "AI"] },
      "Pol": { name: "Engineering Technology (Polytechnic)", majors: ["Mechatronics", "Autotronics", "Civil Engineering", "HVAC Engineering", "Electrical Engineering", "Chemical Engineering"] },
      "Bus": { name: "Business (Salt/Amman)", majors: ["Accounting", "Business Administration", "MIS", "Planning & Project Management", "Finance"] },
      "Agr": { name: "Agriculture", majors: ["Plant Production", "Nutrition", "Water Resources"] }
    }
  },
  "MUTAH": {
    type: "gov",
    name: "Mutah University",
    colleges: {
      "IT": { name: "Information Technology", majors: ["Computer Science", "Software Engineering", "CIS"] },
      "Eng": { name: "Engineering", majors: ["Civil Engineering", "Electrical Engineering", "Mechanical Engineering", "Chemical Engineering", "Computer Engineering", "Industrial Systems"] },
      "Med": { name: "Medical Faculities", majors: ["Medicine", "Nursing", "Pharmacy", "Medical Lab Sciences"] },
      "Sci": { name: "Science", majors: ["Math", "Physics", "Chemistry", "Biology"] },
      "Art": { name: "Arts", majors: ["Arabic", "English", "History"] },
      "Bus": { name: "Business", majors: ["Accounting", "Business Admin", "Economics"] }
    }
  },
  "GJU": {
    type: "gov",
    name: "German Jordanian University (GJU)",
    colleges: {
      "Eng": { name: "Applied Technical Sciences", majors: ["Mechatronics Engineering", "Energy Engineering", "Industrial Engineering", "Maintenance Engineering", "Civil & Environmental Engineering"] },
      "IT": { name: "Computer Engineering & IT", majors: ["Computer Engineering", "Computer Science", "Network Security Engineering"] },
      "Bus": { name: "Management & Logistics", majors: ["International Business", "Logistics Sciences", "Accounting"] },
      "Arc": { name: "Architecture & Built Environment", majors: ["Architecture", "Design and Visual Communication"] }
    }
  },
  "AHU": {
    type: "gov",
    name: "Al-Hussein Bin Talal University (AHU)",
    colleges: {
      "IT": { name: "Information Technology", majors: ["Computer Science", "Software Engineering", "CIS"] },
      "Eng": { name: "Engineering", majors: ["Civil", "Mining", "Environmental", "Computer", "Communications"] },
      "Bus": { name: "Business", majors: ["Business Admin", "Accounting"] }
    }
  },
  "TTU": {
    type: "gov",
    name: "Tafila Technical University (TTU)",
    colleges: {
      "Eng": { name: "Engineering", majors: ["Civil", "Electrical", "Mechanical", "Mechatronics", "Mining"] },
      "Sci": { name: "Science", majors: ["Math", "Physics", "Chemistry"] },
      "IT": { name: "ICT", majors: ["CIS", "Computer Science"] }
    }
  },

  // ==========================================
  // ğŸ¢ PRIVATE UNIVERSITIES (Ø§Ù„Ø¬Ø§Ù…Ø¹Ø§Øª Ø§Ù„Ø®Ø§ØµØ©)
  // ==========================================
  "PSUT": {
    type: "pvt",
    name: "Princess Sumaya University (PSUT)",
    colleges: {
      "IT": { name: "King Hussein School of Computing", majors: ["Computer Science", "Computer Graphics", "Software Engineering", "Cybersecurity", "Data Science and AI"] },
      "Eng": { name: "King Abdullah II School of Engineering", majors: ["Electronics Engineering", "Computer Engineering", "Communications Engineering", "Power & Energy", "Network Security Engineering"] },
      "Bus": { name: "King Talal School of Business", majors: ["Business Information Technology (BIT)", "Accounting", "Business Administration", "E-Marketing"] }
    }
  },
  "HTU": {
    type: "pvt",
    name: "Al Hussein Technical University (HTU)",
    colleges: {
      "Eng": { name: "Engineering", majors: ["Civil Engineering", "Architecture", "Mechanical Engineering", "Electrical Engineering", "Energy Engineering"] },
      "IT": { name: "Informatics & Computing", majors: ["Computer Science", "Data Science and AI", "Cybersecurity"] }
    }
  },
  "ZUJ": {
    type: "pvt",
    name: "Al-Zaytoonah University of Jordan",
    colleges: {
      "IT": { name: "Science & IT", majors: ["Computer Science", "Software Engineering", "Artificial Intelligence", "Cybersecurity", "Data Science"] },
      "Eng": { name: "Engineering", majors: ["Civil", "Mechanical", "Architecture", "Alternative Energy"] },
      "Pha": { name: "Pharmacy", majors: ["Pharmacy"] },
      "Bus": { name: "Business", majors: ["Accounting", "Business Admin", "Marketing"] }
    }
  },
  "ASU": {
    type: "pvt",
    name: "Applied Science University (ASU)",
    colleges: {
      "IT": { name: "Information Technology", majors: ["Computer Science", "Software Engineering", "Data Science"] },
      "Eng": { name: "Engineering", majors: ["Civil", "Mechanical", "Electrical", "Architecture"] },
      "Pha": { name: "Pharmacy", majors: ["Pharmacy"] },
      "Art": { name: "Arts & Design", majors: ["Graphic Design", "Interior Design"] },
      "Bus": { name: "Business", majors: ["Accounting", "Business Admin"] }
    }
  },
  "PU": {
    type: "pvt",
    name: "Philadelphia University",
    colleges: {
      "IT": { name: "Information Technology", majors: ["Computer Science", "Software Engineering", "Information Security", "Web Engineering"] },
      "Eng": { name: "Engineering", majors: ["Mechatronics", "Civil", "Architecture", "Renewable Energy", "Computer Engineering"] },
      "Pha": { name: "Pharmacy", majors: ["Pharmacy"] },
      "Bus": { name: "Business", majors: ["Accounting", "Business Admin", "Marketing"] }
    }
  },
  "UOP": {
    type: "pvt",
    name: "University of Petra (UOP)",
    colleges: {
      "IT": { name: "Information Technology", majors: ["Computer Science", "Information Security", "Software Engineering", "Data Science"] },
      "Arc": { name: "Architecture & Design", majors: ["Architecture", "Interior Design", "Animation", "Graphic Design"] },
      "Pha": { name: "Pharmacy", majors: ["Pharmacy"] },
      "Bus": { name: "Business", majors: ["Business Admin", "Accounting", "Banking", "Marketing"] },
      "Art": { name: "Arts & Sciences", majors: ["English", "Chemistry", "Journalism"] }
    }
  },
  "MEU": {
    type: "pvt",
    name: "Middle East University (MEU)",
    colleges: {
      "IT": { name: "Information Technology", majors: ["Computer Science", "Artificial Intelligence"] },
      "Eng": { name: "Engineering", majors: ["Civil", "Renewable Energy", "Architecture"] },
      "Med": { name: "Media", majors: ["Journalism", "Radio & TV"] },
      "Bus": { name: "Business", majors: ["Accounting", "Business Admin"] },
      "Pha": { name: "Pharmacy", majors: ["Pharmacy"] }
    }
  },
  "AAU": {
    type: "pvt",
    name: "Amman Arab University",
    colleges: {
      "IT": { name: "Computer Science & Informatics", majors: ["Computer Science", "Software Engineering", "Mobile Computing", "CIS"] },
      "Eng": { name: "Engineering", majors: ["Civil", "Architecture", "Renewable Energy"] },
      "Pha": { name: "Pharmacy", majors: ["Pharmacy"] },
      "Bus": { name: "Business", majors: ["Accounting", "Business Admin", "HRM", "Marketing"] }
    }
  },
  "ISRA": {
    type: "pvt",
    name: "Isra University",
    colleges: {
      "IT": { name: "Information Technology", majors: ["Computer Science", "Software Engineering", "CIS", "Multimedia"] },
      "Eng": { name: "Engineering", majors: ["Civil", "Architecture", "Electrical"] },
      "Nur": { name: "Nursing", majors: ["Nursing"] },
      "Bus": { name: "Business", majors: ["Accounting", "Business Admin", "Finance"] }
    }
  },
  "JPU": {
    type: "pvt",
    name: "Jerash University",
    colleges: {
      "IT": { name: "Computer Science & IT", majors: ["Computer Science", "Networks"] },
      "Eng": { name: "Engineering", majors: ["Civil", "Architecture"] },
      "Agr": { name: "Agriculture", majors: ["Plant Production"] },
      "Bus": { name: "Business", majors: ["Accounting", "Business Admin"] }
    }
  },
  "AJL": {
    type: "pvt",
    name: "Ajloun National University",
    colleges: {
      "IT": { name: "Information Technology", majors: ["Computer Science", "Software Engineering"] },
      "Bus": { name: "Business", majors: ["Accounting", "Business Admin", "Banking"] },
      "Law": { name: "Law", majors: ["Law"] }
    }
  },
  "AUM": {
    type: "pvt",
    name: "American University of Madaba (AUM)",
    colleges: {
      "Eng": { name: "Engineering", majors: ["Civil", "Mechanical", "Architecture"] },
      "Sci": { name: "Science", majors: ["Biology", "Biotechnology"] },
      "IT":  { name: "IT", majors: ["Computer Science", "Data Science"] },
      "Bus": { name: "Business", majors: ["Risk Management", "Business Admin", "Accounting", "Marketing"] }
    }
  }
};

// ==========================================================
// 2. OFFICIAL SYLLABUS PLANS (English Keys)
// ==========================================================
// Key Format: University_College_Major
// Matches EXACTLY the values selected in the dropdowns above.

// ==========================================================
// 2. OFFICIAL SYLLABUS PLANS (CORRECTED SYNTAX)
// ==========================================================
window.OFFICIAL_PLANS = {
  // =========================================================================
  // ğŸ›ï¸ AABU (Al al-Bayt) - Data Science (REAL)
  // =========================================================================
  "AABU_IT_Data Science and AI": {
    "Year 1": {
      "Semester 1": [
        { code: "CS111", name: "Intro to CS", credits: 3, prereq: [], type: "major" },
        { code: "MATH101", name: "Calculus 1", credits: 3, prereq: [], type: "coll" },
        { code: "ENG101", name: "English 101", credits: 3, prereq: [], type: "uni" },
        { code: "ARB101", name: "Arabic 101", credits: 3, prereq: [], type: "uni" },
        { code: "MS100", name: "Military Science", credits: 3, prereq: [], type: "uni" }
      ],
      "Semester 2": [
        { code: "CS112", name: "OOP (1)", credits: 3, prereq: ["CS111"], type: "major" },
        { code: "CS113", name: "OOP Lab", credits: 1, prereq: ["CS111"], type: "lab" },
        { code: "MATH102", name: "Calculus 2", credits: 3, prereq: ["MATH101"], type: "coll" },
        { code: "PHYS101", name: "General Physics 1", credits: 3, prereq: [], type: "coll" },
        { code: "CS181", name: "Web Development", credits: 3, prereq: ["CS111"], type: "major" }
      ]
    },
    "Year 2": {
      "Semester 1": [
        { code: "CS211", name: "Data Structures", credits: 3, prereq: ["CS112"], type: "major" },
        { code: "DS201", name: "Intro to Data Science", credits: 3, prereq: ["CS112"], type: "major" },
        { code: "MATH241", name: "Discrete Math", credits: 3, prereq: [], type: "coll" },
        { code: "STAT101", name: "Statistics", credits: 3, prereq: [], type: "coll" },
        { code: "PHYS103", name: "Physics Lab", credits: 1, prereq: ["PHYS101"], type: "lab" }
      ],
      "Semester 2": [
        { code: "CS221", name: "Algorithms", credits: 3, prereq: ["CS211"], type: "major" },
        { code: "AI201", name: "Intro to AI", credits: 3, prereq: ["CS112"], type: "major" },
        { code: "DS210", name: "Data Analysis", credits: 3, prereq: ["DS201"], type: "major" },
        { code: "DS211", name: "Data Analysis Lab", credits: 1, prereq: ["DS201"], type: "lab" }
      ]
    },
    "Year 3": {
      "Semester 1": [
        { code: "AI301", name: "Machine Learning", credits: 3, prereq: ["AI201"], type: "major" },
        { code: "AI302", name: "Machine Learning Lab", credits: 1, prereq: ["AI201"], type: "lab" },
        { code: "DS320", name: "Big Data", credits: 3, prereq: ["DS210"], type: "major" },
        { code: "CS351", name: "Database Systems", credits: 3, prereq: ["CS211"], type: "major" }
      ],
      "Semester 2": [
         { code: "AI320", name: "Deep Learning", credits: 3, prereq: ["AI301"], type: "major" },
         { code: "DS340", name: "Data Mining", credits: 3, prereq: ["DS210"], type: "major" }
      ]
    }
  },

  // =========================================================================
  // ğŸ›ï¸ JUST (Jordan Univ of Science & Tech)
  // =========================================================================
  "JUST_IT_Computer Science": {
    "Year 1": {
      "Semester 1": [
        { code: "CS112", name: "Intro to Programming", credits: 3, prereq: [], type: "major" },
        { code: "MATH101", name: "Calculus 1", credits: 3, prereq: [], type: "coll" },
        { code: "HSS103", name: "Intro to IT", credits: 3, prereq: [], type: "major" },
        { code: "LG101", name: "Communication Skills (En)", credits: 3, prereq: [], type: "uni" },
        { code: "PHY101", name: "General Physics 1", credits: 3, prereq: [], type: "coll" }
      ],
      "Semester 2": [
        { code: "CS113", name: "Object Oriented", credits: 3, prereq: ["CS112"], type: "major" },
        { code: "MATH102", name: "Calculus 2", credits: 3, prereq: ["MATH101"], type: "coll" },
        { code: "MATH241", name: "Discrete Math", credits: 3, prereq: [], type: "coll" },
        { code: "ARB101", name: "Arabic Language", credits: 3, prereq: [], type: "uni" }
      ]
    },
    "Year 2": {
      "Semester 1": [
        { code: "CIS201", name: "Web Design", credits: 3, prereq: ["CS113"], type: "major" },
        { code: "MATH240", name: "Linear Algebra", credits: 3, prereq: ["MATH101"], type: "coll" },
        { code: "CS211", name: "Data Structures", credits: 3, prereq: ["CS113"], type: "major" }
      ],
      "Semester 2": [
        { code: "CIS221", name: "Database Systems", credits: 3, prereq: ["CS211"], type: "major" },
        { code: "CS282", name: "Theory of Computing", credits: 3, prereq: ["MATH241"], type: "major" },
        { code: "CPE231", name: "Digital Logic Design", credits: 3, prereq: ["CS113"], type: "coll" }
      ]
    }
  },

  // =========================================================================
  // ğŸ›ï¸ JU (University of Jordan)
  // =========================================================================
  "JU_IT_Computer Science": {
    "Year 1": {
      "Semester 1": [
        { code: "1901101", name: "CS Fundamentals", credits: 3, prereq: [], type: "major" },
        { code: "0301101", name: "Calculus 1", credits: 3, prereq: [], type: "coll" },
        { code: "1904101", name: "IT Fundamentals", credits: 3, prereq: [], type: "major" },
        { code: "1802101", name: "English 1", credits: 3, prereq: [], type: "uni" }
      ],
      "Semester 2": [
        { code: "1901102", name: "OOP", credits: 3, prereq: ["1901101"], type: "major" },
        { code: "0301102", name: "Calculus 2", credits: 3, prereq: ["0301101"], type: "coll" },
        { code: "0302101", name: "Physics 1", credits: 3, prereq: [], type: "coll" },
        { code: "1801101", name: "Arabic 1", credits: 3, prereq: [], type: "uni" }
      ]
    },
    "Year 2": {
      "Semester 1": [
        { code: "1904231", name: "Digital Logic", credits: 3, prereq: [], type: "coll" },
        { code: "0301241", name: "Linear Algebra", credits: 3, prereq: ["0301102"], type: "coll" },
        { code: "1901211", name: "Data Structures", credits: 3, prereq: ["1901102"], type: "major" }
      ],
      "Semester 2": [
        { code: "1901321", name: "Algorithms", credits: 3, prereq: ["1901211"], type: "major" },
        { code: "1902224", name: "Database Systems", credits: 3, prereq: ["1901102"], type: "major" },
        { code: "1901331", name: "Operating Systems", credits: 3, prereq: ["1901211"], type: "major" }
      ]
    }
  },

  // =========================================================================
  // ğŸ›ï¸ YU (Yarmouk University)
  // =========================================================================
  "YU_IT_Computer Science": {
    "Year 1": {
      "Semester 1": [
        { code: "CS110", name: "Programming 1", credits: 3, prereq: [], type: "major" },
        { code: "CS110L", name: "Programming 1 Lab", credits: 1, prereq: [], type: "lab" },
        { code: "MATH101", name: "Calculus 1", credits: 3, prereq: [], type: "coll" },
        { code: "CIS100", name: "Computer Skills", credits: 3, prereq: [], type: "coll" }
      ],
      "Semester 2": [
        { code: "CS111", name: "Programming 2", credits: 3, prereq: ["CS110"], type: "major" },
        { code: "CS111L", name: "Programming 2 Lab", credits: 1, prereq: ["CS110L"], type: "lab" },
        { code: "MATH241", name: "Discrete Math", credits: 3, prereq: [], type: "coll" },
        { code: "MATH102", name: "Calculus 2", credits: 3, prereq: ["MATH101"], type: "coll" }
      ]
    }
  },

  // =========================================================================
  // ğŸ¢ PSUT (Princess Sumaya)
  // =========================================================================
  "PSUT_IT_Computer Science": {
    "Year 1": {
      "Semester 1": [
        { code: "11102", name: "Intro to CS", credits: 3, prereq: [], type: "major" },
        { code: "20132", name: "Calculus 1", credits: 3, prereq: [], type: "coll" },
        { code: "31111", name: "Arabic Language", credits: 3, prereq: [], type: "uni" }
      ],
      "Semester 2": [
        { code: "11103", name: "Structured Programming", credits: 3, prereq: ["11102"], type: "major" },
        { code: "11151", name: "Programming Lab", credits: 1, prereq: [], coreq: "11103", type: "lab" },
        { code: "20133", name: "Calculus 2", credits: 3, prereq: ["20132"], type: "coll" },
        { code: "20134", name: "Discrete Math 1", credits: 3, prereq: [], type: "coll" }
      ]
    },
    "Year 2": {
      "Semester 1": [
        { code: "11206", name: "OOP", credits: 3, prereq: ["11103"], type: "major" },
        { code: "11253", name: "OOP Lab", credits: 1, prereq: [], coreq: "11206", type: "lab" },
        { code: "11240", name: "Digital Logic", credits: 3, prereq: ["11102"], type: "coll" }
      ]
    }
  },

  // =========================================================================
  // ğŸ›ï¸ HU (Hashemite University)
  // =========================================================================
  "HU_IT_Computer Science": {
    "Year 1": {
      "Semester 1": [
        { code: "110108101", name: "Calculus 1", credits: 3, prereq: [], type: "coll" },
        { code: "110102101", name: "Physics 1", credits: 3, prereq: [], type: "coll" },
        { code: "1001101", name: "CS Fundamentals", credits: 3, prereq: [], type: "major" }
      ],
      "Semester 2": [
        { code: "1001102", name: "OOP", credits: 3, prereq: ["1001101"], type: "major" },
        { code: "110108102", name: "Calculus 2", credits: 3, prereq: ["110108101"], type: "coll" },
        { code: "110101152", name: "Discrete Math", credits: 3, prereq: [], type: "coll" }
      ]
    }
  }
};

// ==========================================
// ğŸ› ï¸ CASCADING DROPDOWN LOGIC
// ==========================================
const secSel = document.getElementById("sectorSelect");
const uniSel = document.getElementById("universitySelect");
const colSel = document.getElementById("collegeSelect");
const majSel = document.getElementById("majorSelect");
const pMajorInput = document.getElementById("pMajor");

// 1. Sector Change
secSel.addEventListener("change", function(){
  const type = this.value;
  uniSel.innerHTML = '<option value="">-- Select University --</option>';
  colSel.innerHTML = '<option value="">-- Select Sector First --</option>';
  majSel.innerHTML = '<option value="">-- Select University First --</option>';
  uniSel.disabled = true; colSel.disabled = true; majSel.disabled = true;

  if(!type) return;

  // Use window.JORDAN_ACADEMIC_DATA
  for (const [key, data] of Object.entries(window.JORDAN_ACADEMIC_DATA)) {
    if(data.type === type){
      const opt = document.createElement("option");
      opt.value = key; // e.g. "AABU"
      opt.textContent = data.name; // e.g. "Al al-Bayt University"
      uniSel.appendChild(opt);
    }
  }
  uniSel.disabled = false;
});

// 2. University Change
uniSel.addEventListener("change", function() {
  const uniKey = this.value;
  colSel.innerHTML = '<option value="">-- Select College --</option>';
  majSel.innerHTML = '<option value="">-- Select Major --</option>';
  colSel.disabled = true; majSel.disabled = true;

  if (uniKey && window.JORDAN_ACADEMIC_DATA[uniKey]) {
    const colleges = window.JORDAN_ACADEMIC_DATA[uniKey].colleges;
    for (const [colKey, colData] of Object.entries(colleges)) {
      const opt = document.createElement("option");
      opt.value = colKey; // e.g. "IT"
      opt.textContent = colData.name;
      colSel.appendChild(opt);
    }
    colSel.disabled = false;
  }
});

// 3. College Change
colSel.addEventListener("change", function() {
  const uniKey = uniSel.value;
  const colKey = this.value;
  majSel.innerHTML = '<option value="">-- Select Major --</option>';
  majSel.disabled = true;

  if (uniKey && colKey && window.JORDAN_ACADEMIC_DATA[uniKey].colleges[colKey]) {
    const majors = window.JORDAN_ACADEMIC_DATA[uniKey].colleges[colKey].majors;
    // majors is now an array of English strings
    majors.forEach(majorName => {
      const opt = document.createElement("option");
      opt.value = majorName; // "Data Science and AI"
      opt.textContent = majorName;
      majSel.appendChild(opt);
    });
    majSel.disabled = false;
  }
});

// 4. Update text field
majSel.addEventListener("change", function() {
  if (pMajorInput) {
    pMajorInput.value = this.value;
  }
});
</script>

</body>
</html>
